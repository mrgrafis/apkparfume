<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pemesanan Parfum</title>
    <style>
        /* General Body Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f2f0, #e0e5f0);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Changed back to 100vh for better overall layout */
            margin: 0;
            padding: 30px;
            color: #333;
            box-sizing: border-box; /* Ensures padding is included in total width/height */
        }

        /* Main Application Container */
        .app-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 700px;
            margin-bottom: 30px;
            box-sizing: border-box;
        }

        /* Navigation Menu Styles */
        .nav-menu {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 15px;
        }
        .nav-menu button {
            background-color: #fff;
            color: #495057;
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            font-size: 17px;
            margin: 0;
            border-radius: 8px 8px 0 0;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
        }
        .nav-menu button.active {
            background-color: #007bff;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2);
            font-weight: bold;
        }
        .nav-menu button:hover:not(.active) {
            background-color: #f0f0f0;
            color: #333;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Content Section Styles */
        .content-section {
            display: none;
            padding-top: 20px;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Heading Styles */
        h2 {
            text-align: center;
            color: #37474f;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }
        h2::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background-color: #007bff;
            margin: 10px auto 0;
            border-radius: 2px;
        }

        /* Form Group Styles */
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            color: #546e7a;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 24px); /* Account for padding */
            padding: 12px;
            border: 1px solid #cfd8dc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
            background-color: #e3f2fd;
        }

        /* Radio Group Styles */
        .radio-group-horizontal label {
            display: inline-block;
            margin-right: 25px;
            font-weight: normal;
            color: #546e7a;
        }
        input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.1);
            cursor: pointer;
        }
        
        /* Button Styles */
        button {
            background-color: #007bff;
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2);
        }
        button:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 10px rgba(0, 86, 179, 0.3);
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 86, 179, 0.4);
        }

        /* Action Buttons Layout */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 25px;
        }
        .action-buttons button {
            flex: 1 1 calc(50% - 10px);
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .action-buttons.wide button {
            flex: 1 1 100%;
        }

        /* Info Display Styles */
        #hargaInfo, #totalKeseluruhanInfo {
            font-weight: bold;
            color: #1e88e5;
            margin-top: 15px;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.1em;
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #90caf9;
        }
        #brandParfumGroup {
            display: none; /* Hidden by default until category selected */
        }

        /* List Item Styles */
        #daftarPesanan, #riwayatPesanan {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #daftarPesanan li, #riwayatPesanan li {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        #daftarPesanan li:hover, #riwayatPesanan li:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
        }
        #daftarPesanan li strong, #riwayatPesanan li strong {
            color: #37474f;
            font-size: 1.1em;
        }

        /* Item Action Buttons (inside list items) */
        .item-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        .item-actions button {
            width: auto;
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 0;
            border-radius: 5px;
            border: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .btn-hapus { background-color: #e53935; color: white; }
        .btn-hapus:hover { background-color: #b71c1c; box-shadow: 0 2px 5px rgba(183, 28, 28, 0.3); }
        .btn-arsip { background-color: #6c757d; color: white; }
        .btn-arsip:hover { background-color: #495057; box-shadow: 0 2px 5px rgba(73, 80, 87, 0.3); }
        .btn-cetak-item-a4 { background-color: #29b6f6; color: white; }
        .btn-cetak-item-a4:hover { background-color: #0288d1; box-shadow: 0 2px 5px rgba(2, 136, 209, 0.3); }
        .btn-cetak-item-termal { background-color: #8bc34a; color: white; }
        .btn-cetak-item-termal:hover { background-color: #689f38; box-shadow: 0 2px 5px rgba(104, 159, 56, 0.3); }

        /* No Pesanan Message */
        .no-pesanan {
            text-align: center;
            color: #78909c;
            font-style: italic;
            padding: 20px;
            background-color: #f0f4f7;
            border-radius: 8px;
            margin-top: 20px;
        }

        /* ======================================================= */
        /* PRINT CSS - INI YANG PENTING UNTUK MENCETAK DENGAN BENAR */
        /* ======================================================= */

        /* Iframe for printing - initially hidden */
        #printIframe {
            display: none; /* Hide by default */
            visibility: hidden; /* Also hide from screen readers/accessibility */
            position: absolute; /* Position off-screen */
            left: -9999px;
            top: -9999px;
            width: 1px; /* Minimal size */
            height: 1px; /* Minimal size */
            border: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Styles applied ONLY when printing */
        @media print {
            /* Hide ALL main UI elements that should NOT be printed */
            body > *:not(#printIframe) { /* Select all direct children of body EXCEPT #printIframe */
                display: none !important;
            }
            .app-container,
            .nav-menu,
            .content-section,
            .action-buttons,
            #hargaInfo,
            #totalKeseluruhanInfo {
                display: none !important; /* Ensure these are hidden */
            }

            /* Show the iframe and make it take over the print area */
            #printIframe {
                display: block !important;
                visibility: visible !important;
                position: static !important; /* Make it part of the normal flow */
                width: 100% !important; /* Take full width */
                height: auto !important; /* Adjust height based on content */
                top: auto !important;
                left: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                overflow: visible !important; /* Ensure content is not clipped */
            }

            /* Global @page rules for the main document - useful as a fallback */
            @page {
                margin: 0 !important; /* Remove default page margins */
                padding: 0 !important;
                /* This specifies a default size, but iframe's @page will be more specific */
                size: auto; /* Let content define size, or specify a large canvas if needed */
            }
        }

        /* --- STYLES FOR THERMAL RECEIPT CONTENT (INSIDE IFRAME) --- */
        /* These styles will be injected into the iframe's <head> when printing thermal */
        .receipt-thermal-body {
            /* IMPORTANT: Set actual physical width of your thermal paper (e.g., 55mm for 5.5cm) */
            width: 55mm; /* This is the target width */
            max-width: 55mm; /* Ensure it doesn't exceed this */
            min-height: 10mm; /* Minimal height */
            margin: 0;
            padding: 0;
            font-family: 'Consolas', 'Courier New', monospace; /* Monospace font for consistent spacing */
            font-size: 15px; /* Adjust font size here, usually larger for readability */
            line-height: 1.2; /* Tighter line spacing */
            color: #000;
            box-sizing: border-box; /* Include padding/border in width */

            /* IMPORTANT: Scaling for smaller printers / better readability on some drivers */
            /* Try one of these. Start with zoom: 125% */
            zoom: 125%; /* Increase content size by 25% */
            /* transform: scale(1.25); transform-origin: top left; */ /* Alternative scaling */
        }
        /* Reset aggressive margins/padding for all elements inside thermal receipt */
        .receipt-thermal-body * {
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
        }

        /* Specific padding/spacing for elements inside thermal receipt */
        .receipt-thermal-body .header,
        .receipt-thermal-body .footer,
        .receipt-thermal-body .section-title,
        .receipt-thermal-body .item-list {
            padding: 0 2mm !important; /* Horizontal padding for content, adjust as needed */
        }
        .receipt-thermal-body hr {
            border: none;
            border-top: 1px dashed #000; /* Dashed line separator */
            margin: 2mm 2mm !important; /* Margin for separator, matching padding */
            width: calc(100% - 4mm) !important; /* Adjust width to fit within padding */
        }
        .receipt-thermal-body .header h3 {
            font-size: 1.2em;
            margin-bottom: 0.5mm !important;
            text-align: center;
        }
        .receipt-thermal-body .header p {
            font-size: 0.9em;
            margin-bottom: 0.2mm !important;
            text-align: center;
        }
        .receipt-thermal-body .item-name {
            width: 100%;
            font-weight: bold;
            white-space: normal;
            word-break: break-word; /* Crucial for long names to wrap */
            font-size: 1.1em;
            margin-bottom: 0.5mm !important;
            text-align: left;
        }
        .receipt-thermal-body .item-qty-price,
        .receipt-thermal-body .item-total-price {
            font-size: 1.05em;
        }
        .receipt-thermal-body .detail-row {
            margin-bottom: 1mm !important;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 0 2mm !important;
        }
        .receipt-thermal-body .total-summary {
            font-size: 1.4em;
            margin-top: 5px !important;
            padding-top: 5px !important;
            font-weight: bold;
        }
        .receipt-thermal-body .footer p {
            font-size: 0.9em;
            margin: 1mm 0 !important;
            text-align: center;
        }
        .receipt-thermal-body .info-note {
            font-size: 0.7em;
            margin-top: 2mm !important;
            text-align: center;
        }
        .receipt-thermal-body .item {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 4px !important;
        }
        .receipt-thermal-body .item .item-name {
            flex-basis: 100%;
            text-align: left;
        }
        .receipt-thermal-body .item .item-qty-price {
            flex-basis: 50%;
            text-align: left;
        }
        .receipt-thermal-body .item .item-total-price {
            flex-basis: 50%;
            text-align: right;
            font-weight: bold;
        }

        /* --- STYLES FOR A4 RECEIPT CONTENT (INSIDE IFRAME) --- */
        /* These styles will be injected into the iframe's <head> when printing A4 */
        .receipt-a4-body {
            padding: 20px;
            width: 210mm; /* A4 width */
            margin: 0 auto;
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #000;
            box-sizing: border-box;
        }
        .receipt-a4-body h3, .receipt-a4-body h4 {
            text-align: center;
            margin-bottom: 15px;
        }
        .receipt-a4-body .order-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .receipt-a4-body .order-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .receipt-a4-body .order-details p {
            margin: 2px 0;
        }
        .receipt-a4-body .total-overall {
            text-align: right;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        .receipt-a4-body .order-detail-box { /* Re-used for single item A4 print */
            border: 1px solid #007bff;
            padding: 15px;
            border-radius: 8px;
            background-color: #e7f0ff;
            margin-bottom: 20px;
        }
        .receipt-a4-body .order-detail-box p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .receipt-a4-body .order-detail-box strong {
            color: #0056b3;
        }
        .receipt-a4-body .order-detail-box .total {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
            text-align: right;
            border-top: 1px dashed #007bff;
            padding-top: 5px;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <div class="nav-menu print-hide">
            <button class="nav-button active" data-target="pemesanan">Form Pemesanan</button>
            <button class="nav-button" data-target="daftar">Daftar Pesanan</button>
            <button class="nav-button" data-target="riwayat">Riwayat Pesanan</button>
        </div>

        <div id="pemesanan" class="content-section active">
            <h2>Form Pemesanan Parfum</h2>
            <form id="parfumForm">
                <div class="form-group">
                    <label for="nama">Nama Pemesan:</label>
                    <input type="text" id="nama" name="nama" required>
                </div>

                <div class="form-group" id="kategoriParfumGroup">
                    <label>Pilih Kategori Parfum:</label>
                    <div class="radio-group-horizontal">
                        <input type="radio" id="kategoriPria" name="kategori" value="pria" onchange="showBrandOptions()" required>
                        <label for="kategoriPria">Pria</label>
                        <input type="radio" id="kategoriWanita" name="kategori" value="wanita" onchange="showBrandOptions()">
                        <label for="kategoriWanita">Wanita</label>
                        <input type="radio" id="kategoriUnisex" name="kategori" value="unisex" onchange="showBrandOptions()">
                        <label for="kategoriUnisex">Unisex</label>
                        <input type="radio" id="kategoriPasangan" name="kategori" value="pasangan" onchange="showBrandOptions()">
                        <label for="kategoriPasangan">Pasangan</label>
                    </div>
                </div>

                <div class="form-group" id="brandParfumGroup">
                    <label for="brandParfum">Pilih Brand Parfum:</label>
                    <select id="brandParfum" name="brandParfum">
                        <option value="">-- Pilih Brand Parfum --</option>
                        </select>
                </div>

                <div class="form-group">
                    <label for="keharumanLain">Atau tulis keharuman/brand lain (opsional):</label>
                    <input type="text" id="keharumanLain" name="keharumanLain" placeholder="Contoh: Kopi, Vanilla Musk, Brand ABC">
                </div>

                <div class="form-group">
                    <label>Jenis Parfum (Ukuran 30ml):</label>
                    <div class="radio-group-horizontal">
                        <input type="radio" id="premium" name="jenisParfum" value="Premium" data-harga="100000" required onchange="updateHarga()">
                        <label for="premium">Premium (Rp 100.000)</label>
                        <input type="radio" id="superPremium" name="jenisParfum" value="Super Premium" data-harga="125000" onchange="updateHarga()">
                        <label for="superPremium">Super Premium (Rp 125.000)</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="jumlah">Jumlah:</label>
                    <input type="number" id="jumlah" name="jumlah" min="1" value="1" required onchange="updateHarga()">
                </div>

                <div id="hargaInfo">Total Harga Item: Rp 0</div>

                <div class="action-buttons wide">
                    <button type="submit" id="btnSimpanPesanan">Simpan Pesanan</button>
                    <button type="button" id="btnCetakPesananSaatIniA4" onclick="cetakPesananSaatIniA4()" style="background-color: #29b6f6;">Cetak Pesanan Saat Ini (A4)</button>
                    <button type="button" id="btnCetakPesananSaatIniTermal" onclick="cetakPesananSaatIniTermal()" style="background-color: #8bc34a;">Cetak Struk Pesanan Saat Ini (Mini)</button>
                </div>
            </form>
        </div>

        <div id="daftar" class="content-section">
            <h2>Daftar Pesanan Tersimpan</h2>
            <ul id="daftarPesanan">
                <p class="no-pesanan">Belum ada pesanan tersimpan.</p>
            </ul>
            <div id="totalKeseluruhanInfo">Total Keseluruhan: Rp 0</div>
            
            <div class="action-buttons wide">
                <button type="button" id="btnCetakTermalMini" onclick="cetakDaftarPesananTermal()" style="background-color: #8bc34a;">Cetak Semua Struk (Mini)</button>
                <button type="button" id="btnCetakSaya" onclick="cetakDaftarPesananA4()" style="background-color: #17a2b8;">Cetak Detail Laporan (A4)</button>
            </div>
            <div class="action-buttons">
                <button type="button" id="btnResetPesanan" onclick="resetPesanan()" class="btn-hapus">Hapus Semua Pesanan</button>
                <button type="button" id="btnArsipSemua" onclick="arsipSemuaPesanan()" class="btn-arsip">Arsipkan Semua Pesanan</button>
            </div>
        </div>

        <div id="riwayat" class="content-section">
            <h2>Riwayat Pemesanan</h2>
            <ul id="riwayatPesanan">
                <p class="no-pesanan">Belum ada riwayat pesanan.</p>
            </ul>
            <div class="action-buttons wide">
                <button type="button" id="btnCetakRiwayatTermal" onclick="cetakRiwayatTermal()" style="background-color: #8bc34a;">Cetak Riwayat (Mini)</button>
                <button type="button" id="btnCetakRiwayatA4" onclick="cetakRiwayatA4()" style="background-color: #6f42c1;">Cetak Riwayat Lengkap (A4)</button>
                <button type="button" id="btnHapusRiwayat" onclick="hapusRiwayat()" class="btn-hapus">Hapus Semua Riwayat</button>
            </div>
        </div>
    </div>

    <iframe id="printIframe" name="printIframe" style="display: none; visibility: hidden; width: 1px; height: 1px;"></iframe>

    <script>
        // DOM Elements
        const parfumForm = document.getElementById('parfumForm');
        const daftarPesananUL = document.getElementById('daftarPesanan');
        const riwayatPesananUL = document.getElementById('riwayatPesanan');
        const hargaInfo = document.getElementById('hargaInfo');
        const totalKeseluruhanInfo = document.getElementById('totalKeseluruhanInfo');
        const brandParfumSelect = document.getElementById('brandParfum');
        const brandParfumGroup = document.getElementById('brandParfumGroup');
        const navButtons = document.querySelectorAll('.nav-button');
        const contentSections = document.querySelectorAll('.content-section');

        let pesananList = []; // Untuk pesanan yang sedang diproses/tersimpan
        let historyList = []; // Untuk pesanan yang sudah diarsipkan

        // Data Brand Parfum (sekitar 100+ per kategori) - Sudah ada dari kode Anda
        const brandParfumData = {
            pria: [ "Acqua di Parma", "Armani Code", "Bleu de Chanel", "Boss Bottled", "Bvlgari Man", "Carolina Herrera Bad Boy", "Chanel Allure Homme Sport", "Christian Dior Sauvage", "Creed Aventus", "Davidoff Cool Water", "Dior Homme", "Dolce & Gabbana The One For Men", "Dunhill Icon", "Giorgio Armani Acqua di Gio", "Givenchy Gentleman", "Gucci Guilty Pour Homme", "Hermès Terre d'Hermès", "Invictus Paco Rabanne", "Jean Paul Gaultier Le Male", "Jo Malone Wood Sage & Sea Salt (Men)", "John Varvatos Artisan", "Lacoste L.12.12", "Montblanc Explorer", "Nautica Voyage", "Paco Rabanne 1 Million", "Polo Ralph Lauren Blue", "Prada L'Homme", "Tom Ford Oud Wood", "Versace Dylan Blue", "Viktor & Rolf Spicebomb", "YSL Y", "Azzaro Wanted", "Bentley For Men Intense", "Burberry Brit For Men", "Calvin Klein Eternity for Men", "Coach For Men", "Dolce & Gabbana K", "DSQUARED2 Wood Pour Homme", "Ermenegildo Zegna Uomo", "Ferrari Black", "Gucci Guilty Absolute", "Issey Miyake L'Eau d'Issey Pour Homme", "Jimmy Choo Man", "Kenzo Pour Homme", "Loewe 7", "Maison Margiela Replica Jazz Club", "Mugler A*Men", "Narciso Rodriguez For Him", "Paco Rabanne Phantom", "Penhaligon's Halfeti", "Ralph Lauren Polo Green", "Roja Dove Elysium", "Salvatore Ferragamo F by Ferragamo", "Thierry Mugler Alien Man", "Tommy Hilfiger Tommy", "Trussardi My Land", "Valentino Uomo Born In Roma", "Van Cleef & Arpels Pour Homme", "Versace Eros", "Victorinox Swiss Army Classic", "Yves Saint Laurent Kouros", "Zegna Essenze Collection", "Adnan B. Royal Touch", "Alfred Dunhill Desire Blue", "Antonio Banderas Blue Seduction", "Bottega Veneta Pour Homme", "Brioni Eau de Parfum", "Cartier Pasha de Cartier", "Coach Platinum", "Creed Green Irish Tweed", "Diesel Only The Brave", "Ermenegildo Zegna Z Zegna", "Ferrari Scuderia Black", "Givenchy Pi", "Gucci Pour Homme II", "Guess Seductive Homme Blue", "Hugo Boss The Scent", "Jaguar Classic Black", "Joop! Homme", "Karl Lagerfeld Pour Homme", "Lalique Encre Noire", "Mancera Cedrat Boise", "Mercedes-Benz Man", "Michael Kors for Men", "Montblanc Legend", "Mugler Cologne", "Paco Rabanne Pure XS", "Penhaligon's Blenheim Bouquet", "Porsche Design 180", "Ralph Lauren Polo Black", "Roja Dove Scandal Pour Homme", "Sergio Tacchini O-Zone Man", "Ted Lapidus Pour Homme", "Tom Ford Beau De Jour", "Truefitt & Hill Trafalgar", "Uomo Salvatore Ferragamo", "Van Gils Between Sheets", "Versace Pour Homme", "Yves Saint Laurent Kouros", "Zadig & Voltaire This Is Him!", "Zara Man Gold", "Ajmal Evoke Gold Edition For Him" ],
            wanita: [ "Ariana Grande Cloud", "Black Opium YSL", "Britney Spears Fantasy", "Bvlgari Omnia Crystalline", "Calvin Klein Euphoria", "Carolina Herrera Good Girl", "Chanel Chance Eau Tendre", "Chanel Coco Mademoiselle", "Chloe Eau de Parfum", "Christian Dior J'adore", "Dior Miss Dior", "Dolce & Gabbana Light Blue", "Elizabeth Arden 5th Avenue", "Estee Lauder Beautiful", "Givenchy L'Interdit", "Giorgio Armani My Way", "Gucci Bloom", "Guerlain Mon Guerlain", "Jean Paul Gaultier La Belle", "Jo Malone Peony & Blush Suede", "Jimmy Choo Blossom", "Lancôme La Vie Est Belle", "Marc Jacobs Daisy", "Mugler Alien", "Narciso Rodriguez For Her", "Paco Rabanne Lady Million", "Prada Candy", "Thierry Mugler Angel", "Tom Ford Black Orchid", "Versace Bright Crystal", "Viktor & Rolf Flowerbomb", "Yves Saint Laurent Libre", "Burberry Her", "Byredo Mojave Ghost", "Carolina Herrera 212 NYC", "Chanel No. 5", "Clean Reserve Warm Cotton", "Dior Poison Girl", "Donna Karan DKNY Be Delicious", "Elizabeth Taylor White Diamonds", "Escada Miami Blossom", "Estee Lauder Pleasures", "Giorgio Armani Si", "Givenchy Irresistible", "Gucci Flora Gorgeous Gardenia", "Guerlain Shalimar", "Hugo Boss Woman", "Issey Miyake L'Eau d'Issey", "Jean Paul Gaultier Classique", "Juliette Has A Gun Not a Perfume", "Kenzo Flower", "Kilian Love, Don't Be Shy", "Lanvin Eclat d'Arpège", "Loewe Aura", "Maison Margiela Replica Beach Walk", "Michael Kors Glam Jasmine", "Moschino Toy 2", "Nina Ricci L'Air du Temps", "Paco Rabanne Fame", "Penhaligon's Luna", "Philosophy Amazing Grace", "Ralph Lauren Romance", "Roja Dove Enigma Pour Femme", "Salvatore Ferragamo Signorina", "Shiseido Ever Bloom", "Stella McCartney Stella", "The Body Shop White Musk", "Tiffany & Co. Eau de Parfum", "Tom Ford Orchid Soleil", "Tous Tous Tous Bear", "Trussardi Donna", "Valentino Donna Born In Roma", "Van Cleef & Arpels Feerie", "Vera Wang Princess", "Victoria's Secret Bombshell", "Zara Orchid", "Elizabeth Arden Green Tea", "Escada Cherry in Japan", "Clinique Happy", "DKNY Stories", "Elie Saab Le Parfum", "Gucci Rush", "Guess Seductive", "Hollister Wave For Her", "Jesus Del Pozo Halloween", "Juicy Couture Viva La Juicy", "Kate Spade New York", "Kylie Minogue Darling", "Maison Francis Kurkdjian Baccarat Rouge 540 (Women)", "Moschino I Love Love", "Narciso Rodriguez Pure Musc", "Oscar de la Renta Oscar", "Rihanna Reb'l Fleur", "Tommy Hilfiger Tommy Girl", "Versace Crystal Noir", "Victoria's Secret Tease", "YSL Mon Paris", "Zoella Beauty Splash" ],
            unisex: [ "Byredo Gypsy Water", "Byredo Bal d'Afrique", "Calvin Klein CK One", "Clean Reserve Rain", "D.S. & Durga Debaser", "Diptyque Philosykos", "Escentric Molecules Molecule 01", "Ex Nihilo Fleur Narcotique", "Frederic Malle Portrait of a Lady", "Glossier You", "Initio Parfums Prives Oud for Greatness", "Jo Malone Lime Basil & Mandarin", "Kilian Back to Black", "Le Labo Santal 33", "Maison Francis Kurkdjian Baccarat Rouge 540", "Maison Margiela Replica By the Fireplace", "Memo Paris Irish Leather", "Montale Intense Cafe", "Nishane Hacivat", "Ormonde Jayne Ormonde Man", "Parfums de Marly Layton", "Penhaligon's The Tragedy of Lord George", "Roja Dove Aoud", "Serge Lutens Chergui", "Tiziana Terenzi Kirke", "Tom Ford Tobacco Vanille", "Xerjoff Naxos", "Amouage Interlude Man", "Atelier Cologne Orange Sanguine", "Bond No. 9 Wall Street", "Creed Royal Oud", "DSQUARED2 Wood Sage", "Eight & Bob Original", "Floris No. 89", "Givenchy Hot Couture", "Gucci Mémoire d'une Odeur", "Heeley Sel Marin", "Imaginary Authors A City on Fire", "Jovoy Paris Psychedelique", "Kismet Angel by Maison Alhambra", "Lalique White", "Louis Vuitton Ombre Nomade", "Maison Crivelli Papyrus Moléculaire", "Memo Paris African Leather", "Montale Black Aoud", "Nasomatto Black Afgano", "Ormonde Jayne Montabaco", "Parfums de Marly Herod", "Penhaligon's Endymion", "Phaedon Antigua", "Roja Dove Reckless", "Serge Lutens Ambre Sultan", "The House of Oud Breath Of The Infinite", "Tom Ford Fucking Fabulous", "Tiziana Terenzi Laudano Nero", "Xerjoff Alexandria II", "Zara Ebony Wood", "Zarkoperfume Cloud Collection No.1", "Amouage Reflection Man", "Atelier Cologne Vanille Insensée", "Bond No. 9 New York Oud", "Creed Virgin Island Water", "Demeter Fragrance Library", "Eight & Bob Annicke Goutal", "Floris Santal", "Givenchy Insense", "Gucci The Alchemist's Garden", "Guess Seductive", "Hollister Wave For Her", "Hugo Boss The Scent", "Imaginary Authors Memoirs of a Trespasser", "Jovoy Paris Remember Me", "Kayali Vanilla | 28", "L'Artisan Parfumeur Mûre et Musc", "Lalique Encre Noire", "Louis Vuitton L'Immensité", "Maison Crivelli Rose Saltifolia", "Memo Paris Marfa", "Montale Rose Musk", "Nasomatto Duro", "Ormonde Jayne Montabaco", "Parfums de Marly Herod", "Penhaligon's Endymion", "Phaedon Antigua", "Roja Dove Reckless", "Serge Lutens Ambre Sultan", "The House of Oud Breath Of The Infinite", "Tom Ford Fucking Fabulous", "Tiziana Terenzi Laudano Nero", "Xerjoff Alexandria II", "Zara Ebony Wood", "Zarkoperfume Cloud Collection No.2", "Afnan Supremacy Not Only Intense" ],
            pasangan: [ "Calvin Klein Obsessed For Men & Women", "Jo Malone English Pear & Freesia (Unisex/Pairing)", "Tom Ford Ombre Leather (Often Paired)", "Byredo Mixed Emotions (Often Paften Paired)", "Initio Parfums Prives Oud for Greatness (Pairing)", "Montale Intense Cafe & Roses Musk (Pairing)", "Le Labo Bergamote 22 & Santal 33 (Pairing)", "Roja Dove Scandal Pour Homme & Enigma Pour Femme (Pairing)", "Creed Aventus & Aventus for Her (Pairing)", "YSL Y & Libre (Pairing)", "Dior Sauvage & J'adore (Pairing)", "Chanel Bleu de Chanel & Coco Mademoiselle (Pairing)", "Paco Rabanne 1 Million & Lady Million (Pairing)", "Giorgio Armani Acqua di Gio & My Way (Pairing)", "Versace Eros & Bright Crystal (Pairing)", "Dolce & Gabbana The One For Men & The One For Women (Pairing)", "Givenchy Gentleman & L'Interdit (Pairing)", "Gucci Guilty Pour Homme & Guilty Pour Femme (Pairing)", "Hermès Terre d'Hermès & Twilly d'Hermès (Pairing)", "Polo Ralph Lauren Blue & Romance (Pairing)", "Prada L'Homme & La Femme (Pairing)", "Viktor & Rolf Spicebomb & Flowerbomb (Pairing)", "Penhaligon's Endymion & Luna (Pairing)", "Maison Margiela Replica By the Fireplace & Jazz Club (Pairing)", "Amouage Interlude Man & Interlude Woman (Pairing)", "Xerjoff Naxos & Erba Pura (Pairing)", "Bvlgari Man & Omnia Crystalline (Pairing)", "Hugo Boss Bottled & Boss The Scent for Her (Pairing)", "Lacoste L.12.12 Pour Homme & Pour Femme (Pairing)", "Montblanc Explorer & Legend Spirit (Pairing for fresh)", "Nishane Hacivat & Ani (Pairing)", "Ormonde Jayne Ormonde Man & Woman (Pairing)", "Parfums de Marly Layton & Delina (Pairing)", "Serge Lutens Chergui & Ambre Sultan (Pairing for oriental)", "Tiziana Terenzi Kirke & Andromeda (Pairing)", "Zara Vibrant Leather & Zara Orchid (Pairing)", "Zarkoperfume Cloud Collection No.1 & No.2 (Pairing)", "Bottega Veneta Pour Homme & Femme (Pairing)", "Burberry Brit For Men & Her (Pairing)", "Calvin Klein Eternity for Men & Women (Pairing)", "Coach For Men & Women (Pairing)", "Diesel Only The Brave & Loverdose (Pairing)", "Dunhill Icon & Desire (Pairing)", "Elizabeth Arden 5th Avenue & Green Tea (Pairing)", "Estee Lauder Beautiful & Pleasures (Pairing)", "Guerlain L'Homme Ideal & Mon Guerlain (Pairing)", "Guess Seductive Homme & Seductive (Pairing)" ]
        };

        // Global variables to store generated HTML content for "current order"
        let thermalReceiptHtml = "";
        let a4ReceiptHtml = "";

        // --- Helper Functions ---

        function formatRupiah(angka) {
            let reverse = angka.toString().split('').reverse().join('');
            let ribuan = reverse.match(/\d{1,3}/g);
            let result = ribuan.join('.').split('').reverse().join('');
            return 'Rp ' + result;
        }

        // Generate content for Thermal Receipt (raw text/simple HTML)
        function generateThermalReceiptContent(pesanan) {
            const selectedBrand = pesanan.brand || 'Tidak ada brand/keharuman lain'; // Fallback if empty
            const formattedHargaItem = formatRupiah(pesanan.hargaItem);
            const formattedTotalHarga = formatRupiah(pesanan.totalHarga);
            const formattedHargaPerBotol = formatRupiah(pesanan.hargaPerBotol);

            return `
<pre>
By. ENERGIA AURA PARFUME
Jl. Komp. CikawaO Persada Blok G1 No 21
Telp: 0851-4215-6602
Tgl: ${pesanan.tanggal}, ${pesanan.waktu}
------------------------------------
STRUK PEMESANAN UNTUK: ${pesanan.namaPemesanan.toUpperCase()}
------------------------------------
Produk  : ${selectedBrand}
Jenis   : ${pesanan.jenis}
Jumlah  : ${pesanan.jumlah} Botol
Harga/B : ${formattedHargaPerBotol}
Total   : ${formattedHargaItem}
------------------------------------
TOTAL KESELURUHAN: ${formattedTotalHarga}
------------------------------------
TERIMA KASIH ATAS KUNJUNGANNYA
*** BARANG YANG SUDAH DIBELI TIDAK
    DAPAT DIKEMBALIKAN ***
Sistem Pemesanan v1.0
</pre>
            `;
        }

        // Generate content for A4 Receipt (more structured HTML)
        function generateA4ReceiptContent(pesanan) {
            const selectedBrand = pesanan.brand || 'Tidak ada brand/keharuman lain'; // Fallback if empty
            const formattedHargaItem = formatRupiah(pesanan.hargaItem);
            const formattedTotalHarga = formatRupiah(pesanan.totalHarga);
            const formattedHargaPerBotol = formatRupiah(pesanan.hargaPerBotol);

            return `
                <div class="receipt-a4-content">
                    <div class="header">
                        <h3>By. ENERGIA AURA PARFUME</h3>
                        <p>Jl. Komp. CikawaO Persada Blok G1 No 21</p>
                        <p>Telp: 0851-4215-6602</p>
                        <p>Tgl: ${pesanan.tanggal}, ${pesanan.waktu}</p>
                        <hr/>
                        <h4>STRUK PEMESANAN UNTUK: ${pesanan.namaPemesanan.toUpperCase()}</h4>
                    </div>
                    <div class="order-detail-box">
                        <p><strong>Produk:</strong> ${selectedBrand}</p>
                        <p><strong>Jenis:</strong> ${pesanan.jenis}</p>
                        <p><strong>Jumlah:</strong> ${pesanan.jumlah} botol</p>
                        <p><strong>Harga per botol:</strong> ${formattedHargaPerBotol}</p>
                        <p class="total"><strong>Total Item:</strong> ${formattedHargaItem}</p>
                    </div>
                    <div class="total-overall">
                        Total Keseluruhan: ${formattedTotalHarga}
                    </div>
                    <hr/>
                    <div class="footer" style="text-align: center;">
                        <p>TERIMA KASIH ATAS KUNJUNGANNYA</p>
                        <p>*** BARANG YANG SUDAH DIBELI TIDAK DAPAT DIKEMBALIKAN ***</p>
                        <p>Sistem Pemesanan v1.0</p>
                    </div>
                </div>
            `;
        }


        // --- Core Application Logic ---

        function showBrandOptions() {
            const kategori = document.querySelector('input[name="kategori"]:checked')?.value;
            brandParfumSelect.innerHTML = '<option value="">-- Pilih Brand Parfum --</option>'; // Reset options

            if (kategori && brandParfumData[kategori]) {
                brandParfumData[kategori].forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandParfumSelect.appendChild(option);
                });
                brandParfumGroup.style.display = 'block';
            } else {
                brandParfumGroup.style.display = 'none';
            }
        }

        function updateHarga() {
            const jenisParfumRadio = document.querySelector('input[name="jenisParfum"]:checked');
            const jumlah = parseInt(document.getElementById('jumlah').value);
            let hargaPerBotol = 0;

            if (jenisParfumRadio) {
                hargaPerBotol = parseInt(jenisParfumRadio.dataset.harga);
            }

            const totalHargaItem = hargaPerBotol * (isNaN(jumlah) ? 0 : jumlah);
            hargaInfo.textContent = `Total Harga Item: ${formatRupiah(totalHargaItem)}`;
        }

        function renderPesanan() {
            daftarPesananUL.innerHTML = ''; // Clear current list
            if (pesananList.length === 0) {
                daftarPesananUL.innerHTML = '<p class="no-pesanan">Belum ada pesanan tersimpan.</p>';
            } else {
                pesananList.forEach((pesanan, index) => {
                    const listItem = document.createElement('li');
                    const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';

                    listItem.innerHTML = `
                        <strong>${pesanan.namaPemesanan}</strong> (${pesanan.tanggal} ${pesanan.waktu})<br>
                        Produk: ${selectedBrand}<br>
                        Jenis: ${pesanan.jenis}<br>
                        Jumlah: ${pesanan.jumlah} botol @${formatRupiah(pesanan.hargaPerBotol)}<br>
                        Total: ${formatRupiah(pesanan.totalHarga)}
                        <div class="item-actions">
                            <button onclick="cetakItemTermal(${index})" class="btn-cetak-item-termal">Cetak Mini</button>
                            <button onclick="cetakItemA4(${index})" class="btn-cetak-item-a4">Cetak A4</button>
                            <button onclick="arsipPesanan(${index})" class="btn-arsip">Arsipkan</button>
                            <button onclick="hapusPesanan(${index})" class="btn-hapus">Hapus</button>
                        </div>
                    `;
                    daftarPesananUL.appendChild(listItem);
                });
            }
            updateOverallTotal();
            saveData();
        }

        function renderHistory() {
            riwayatPesananUL.innerHTML = ''; // Clear current list
            if (historyList.length === 0) {
                riwayatPesananUL.innerHTML = '<p class="no-pesanan">Belum ada riwayat pesanan.</p>';
            } else {
                historyList.forEach((pesanan, index) => {
                    const listItem = document.createElement('li');
                    const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
                    listItem.innerHTML = `
                        <strong>${pesanan.namaPemesanan}</strong> (${pesanan.tanggal} ${pesanan.waktu}) [Arsip]<br>
                        Produk: ${selectedBrand}<br>
                        Jenis: ${pesanan.jenis}<br>
                        Jumlah: ${pesanan.jumlah} botol @${formatRupiah(pesanan.hargaPerBotol)}<br>
                        Total: ${formatRupiah(pesanan.totalHarga)}
                        <div class="item-actions">
                            <button onclick="cetakHistoryItemTermal(${index})" class="btn-cetak-item-termal">Cetak Mini</button>
                            <button onclick="cetakHistoryItemA4(${index})" class="btn-cetak-item-a4">Cetak A4</button>
                            <button onclick="restorePesanan(${index})" class="btn-arsip">Pulihkan</button>
                            <button onclick="hapusHistoryPesanan(${index})" class="btn-hapus">Hapus</button>
                        </div>
                    `;
                    riwayatPesananUL.appendChild(listItem);
                });
            }
            saveData();
        }

        function updateOverallTotal() {
            const total = pesananList.reduce((sum, pesanan) => sum + pesanan.totalHarga, 0);
            totalKeseluruhanInfo.textContent = `Total Keseluruhan: ${formatRupiah(total)}`;
        }

        function saveData() {
            localStorage.setItem('pesananList', JSON.stringify(pesananList));
            localStorage.setItem('historyList', JSON.stringify(historyList));
        }

        function loadData() {
            const storedPesanan = localStorage.getItem('pesananList');
            const storedHistory = localStorage.getItem('historyList');
            if (storedPesanan) {
                pesananList = JSON.parse(storedPesanan);
            }
            if (storedHistory) {
                historyList = JSON.parse(storedHistory);
            }
            renderPesanan();
            renderHistory();
        }

        parfumForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const nama = document.getElementById('nama').value;
            const kategori = document.querySelector('input[name="kategori"]:checked')?.value;
            const brand = brandParfumSelect.value;
            const keharumanLain = document.getElementById('keharumanLain').value;
            const jenisParfumRadio = document.querySelector('input[name="jenisParfum"]:checked');
            const jenisParfum = jenisParfumRadio ? jenisParfumRadio.value : '';
            const hargaPerBotol = jenisParfumRadio ? parseInt(jenisParfumRadio.dataset.harga) : 0;
            const jumlah = parseInt(document.getElementById('jumlah').value);

            // Validasi lebih lanjut jika diperlukan
            if (!nama || !kategori || (!brand && !keharumanLain) || !jenisParfum || isNaN(jumlah) || jumlah <= 0) {
                alert('Mohon lengkapi semua data pesanan yang wajib (Nama, Kategori, Brand/Keharuman Lain, Jenis, Jumlah)!');
                return;
            }

            const totalHargaItem = hargaPerBotol * jumlah;
            const now = new Date();
            const tanggal = now.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(/\//g, '/');
            const waktu = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', hour12: false });

            const newPesanan = {
                id: Date.now(), // Unique ID for each order
                namaPemesanan: nama,
                kategori: kategori,
                brand: brand,
                keharumanLain: keharumanLain,
                jenis: jenisParfum,
                hargaPerBotol: hargaPerBotol,
                jumlah: jumlah,
                hargaItem: hargaPerBotol * jumlah, // Harga per item
                totalHarga: totalHargaItem, // Total harga keseluruhan untuk pesanan ini
                tanggal: tanggal,
                waktu: waktu
            };

            pesananList.push(newPesanan);
            renderPesanan();
            parfumForm.reset(); // Reset form after submission
            hargaInfo.textContent = 'Total Harga Item: Rp 0'; // Reset harga info
            brandParfumGroup.style.display = 'none'; // Hide brand options

            // Store current order HTML for immediate printing
            thermalReceiptHtml = generateThermalReceiptContent(newPesanan);
            a4ReceiptHtml = generateA4ReceiptContent(newPesanan);

            alert('Pesanan berhasil disimpan!');
        });

        function hapusPesanan(index) {
            if (confirm('Anda yakin ingin menghapus pesanan ini?')) {
                pesananList.splice(index, 1);
                renderPesanan();
            }
        }

        function arsipPesanan(index) {
            if (confirm('Anda yakin ingin mengarsipkan pesanan ini?')) {
                const [movedPesanan] = pesananList.splice(index, 1);
                historyList.push(movedPesanan);
                renderPesanan();
                renderHistory();
            }
        }

        function restorePesanan(index) {
            if (confirm('Anda yakin ingin memulihkan pesanan ini dari arsip?')) {
                const [movedPesanan] = historyList.splice(index, 1);
                pesananList.push(movedPesanan);
                renderPesanan();
                renderHistory();
            }
        }

        function hapusHistoryPesanan(index) {
            if (confirm('Anda yakin ingin menghapus riwayat pesanan ini secara permanen?')) {
                historyList.splice(index, 1);
                renderHistory();
            }
        }

        function resetPesanan() {
            if (confirm('Anda yakin ingin menghapus semua pesanan saat ini? (Ini tidak akan menghapus riwayat)')) {
                pesananList = [];
                renderPesanan();
                alert('Semua pesanan saat ini telah dihapus.');
            }
        }

        function arsipSemuaPesanan() {
            if (pesananList.length === 0) {
                alert('Tidak ada pesanan untuk diarsipkan.');
                return;
            }
            if (confirm('Anda yakin ingin mengarsipkan semua pesanan saat ini?')) {
                historyList = historyList.concat(pesananList); // Add all current orders to history
                pesananList = []; // Clear current orders
                renderPesanan();
                renderHistory();
                alert('Semua pesanan telah diarsipkan.');
            }
        }

        function hapusRiwayat() {
            if (historyList.length === 0) {
                alert('Tidak ada riwayat untuk dihapus.');
                return;
            }
            if (confirm('Anda yakin ingin menghapus semua riwayat pesanan secara permanen?')) {
                historyList = [];
                renderHistory();
                alert('Semua riwayat pesanan telah dihapus.');
            }
        }


        // --- Navigasi Tab ---
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;

                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                contentSections.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.add('active');
                    } else {
                        section.classList.remove('active');
                    }
                });

                // Re-render appropriate list when tab is clicked
                if (targetId === 'daftar') {
                    renderPesanan();
                } else if (targetId === 'riwayat') {
                    renderHistory();
                }
            });
        });

        // --- Print Functions using Iframe ---

        // Helper function to print content via iframe
        function printContentViaIframe(contentHtml, paperType) {
            const printIframe = document.getElementById('printIframe');
            if (!printIframe) {
                console.error("Iframe for printing not found!");
                alert("Terjadi kesalahan: Elemen cetak tidak ditemukan.");
                return;
            }

            const iframeDoc = printIframe.contentWindow.document;

            iframeDoc.open();
            if (paperType === 'Thermal') {
                iframeDoc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Struk Thermal</title>
                        <style>
                            /* Styles for the body inside the thermal iframe */
                            body {
                                margin: 0; padding: 0;
                                font-family: 'Consolas', 'Courier New', monospace;
                                color: #000;
                                width: 55mm; /* Crucial for thermal printer width */
                                max-width: 55mm;
                                box-sizing: border-box;
                                /* Try 'zoom' first, if not good, try 'transform' */
                                zoom: 125%; /* Adjust this value (e.g., 120%, 130%) to make print larger/smaller */
                                /* transform: scale(1.25); transform-origin: top left; */
                            }
                            /* Ensure pre tag or main content div fills width and wraps */
                            pre {
                                margin: 0; padding: 0;
                                white-space: pre-wrap; /* Allows text to wrap */
                                word-wrap: break-word; /* For very long words */
                                font-family: 'Consolas', 'Courier New', monospace;
                                font-size: 15px; /* Adjust font size within the thermal content */
                                line-height: 1.2;
                                width: 100%; /* Make pre fill 100% of body width */
                                box-sizing: border-box;
                            }
                            /* Styles for structured thermal content if not using <pre> */
                            .receipt-thermal-body * {
                                margin: 0 !important;
                                padding: 0 !important;
                                box-sizing: border-box !important;
                            }
                            .receipt-thermal-body .header, .receipt-thermal-body .footer, .receipt-thermal-body .section-title, .receipt-thermal-body .item-list { padding: 0 2mm !important; }
                            .receipt-thermal-body hr { border: none; border-top: 1px dashed #000; margin: 2mm 2mm !important; width: calc(100% - 4mm) !important; }
                            .receipt-thermal-body .header h3 { font-size: 1.2em; margin-bottom: 0.5mm !important; text-align: center; }
                            .receipt-thermal-body .header p { font-size: 0.9em; margin-bottom: 0.2mm !important; text-align: center; }
                            .receipt-thermal-body .item-name { width: 100%; font-weight: bold; white-space: normal; word-break: break-word; font-size: 1.1em; margin-bottom: 0.5mm !important; text-align: left; }
                            .receipt-thermal-body .item-qty-price, .receipt-thermal-body .item-total-price { font-size: 1.05em; }
                            .receipt-thermal-body .detail-row { margin-bottom: 1mm !important; display: flex; justify-content: space-between; align-items: baseline; padding: 0 2mm !important; }
                            .receipt-thermal-body .total-summary { font-size: 1.4em; margin-top: 5px !important; padding-top: 5px !important; font-weight: bold; }
                            .receipt-thermal-body .footer p { font-size: 0.9em; margin: 1mm 0 !important; text-align: center; }
                            .receipt-thermal-body .info-note { font-size: 0.7em; margin-top: 2mm !important; text-align: center; }
                            .receipt-thermal-body .item { display: flex; flex-wrap: wrap; justify-content: space-between; margin-bottom: 4px !important; }
                            .receipt-thermal-body .item .item-name { flex-basis: 100%; text-align: left; }
                            .receipt-thermal-body .item .item-qty-price { flex-basis: 50%; text-align: left; }
                            .receipt-thermal-body .item .item-total-price { flex-basis: 50%; text-align: right; font-weight: bold; }

                            /* @page rules for thermal printing within the iframe */
                            @page {
                                margin: 0 !important; /* No margins */
                                padding: 0 !important;
                                size: 5.5cm auto; /* Width 5.5cm, height auto */
                            }
                        </style>
                    </head>
                    <body class="receipt-thermal-body">
                        ${contentHtml}
                    </body>
                    </html>
                `);
            } else if (paperType === 'A4') {
                iframeDoc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Laporan A4</title>
                        <style>
                            /* Styles for the body inside the A4 iframe */
                            body {
                                margin: 0; padding: 0;
                                font-family: Arial, sans-serif;
                                color: #000;
                                width: 210mm; /* Standard A4 width */
                                box-sizing: border-box;
                            }
                            /* Styles for the main content div within the A4 iframe */
                            .receipt-a4-content {
                                padding: 20px;
                                width: 100%;
                                margin: 0 auto;
                                font-family: Arial, sans-serif;
                                font-size: 12px;
                                line-height: 1.5;
                                color: #000;
                                box-sizing: border-box;
                            }
                            /* Copy all .receipt-a4-body styles here */
                            .receipt-a4-content h3, .receipt-a4-content h4 { text-align: center; margin-bottom: 15px; }
                            .receipt-a4-content .order-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
                            .receipt-a4-content .order-item strong { display: block; margin-bottom: 5px; font-size: 1.1em; }
                            .receipt-a4-content .order-details p { margin: 2px 0; }
                            .receipt-a4-content .total-overall { text-align: right; font-size: 1.3em; font-weight: bold; margin-top: 20px; border-top: 1px solid #000; padding-top: 10px; }
                            .receipt-a4-content .order-detail-box { border: 1px solid #007bff; padding: 15px; border-radius: 8px; background-color: #e7f0ff; margin-bottom: 20px; }
                            .receipt-a4-content .order-detail-box p { margin: 5px 0; font-size: 1.1em; }
                            .receipt-a4-content .order-detail-box strong { color: #0056b3; }
                            .receipt-a4-content .order-detail-box .total { font-size: 1.2em; font-weight: bold; margin-top: 10px; text-align: right; border-top: 1px dashed #007bff; padding-top: 5px; }

                            /* @page rules for A4 printing within the iframe */
                            @page {
                                size: A4;
                                margin: 1cm; /* Standard A4 margins */
                            }
                        </style>
                    </head>
                    <body class="receipt-a4-body">
                        ${contentHtml}
                    </body>
                    </html>
                `);
            }
            iframeDoc.close();

            // Set a timeout to ensure iframe content is rendered before printing
            // This is especially helpful on mobile browsers.
            setTimeout(() => {
                try {
                    printIframe.contentWindow.focus();
                    printIframe.contentWindow.print();
                } catch (e) {
                    console.error("Auto print failed:", e);
                    alert("Gagal mencetak otomatis. Silakan atur manual print dari menu browser.");
                }
            }, 500); // 500ms delay, adjust if needed
        }

        // --- Specific Print Call Functions ---

        function cetakPesananSaatIniTermal() {
            if (!thermalReceiptHtml) {
                alert('Belum ada struk pesanan saat ini untuk dicetak. Harap simpan pesanan terlebih dahulu.');
                return;
            }
            printContentViaIframe(thermalReceiptHtml, 'Thermal');
        }

        function cetakPesananSaatIniA4() {
            if (!a4ReceiptHtml) {
                alert('Belum ada detail pesanan saat ini untuk dicetak. Harap simpan pesanan terlebih dahulu.');
                return;
            }
            printContentViaIframe(a4ReceiptHtml, 'A4');
        }

        function cetakItemTermal(index) {
            const pesanan = pesananList[index];
            if (!pesanan) return; // Should not happen
            printContentViaIframe(generateThermalReceiptContent(pesanan), 'Thermal');
        }

        function cetakItemA4(index) {
            const pesanan = pesananList[index];
            if (!pesanan) return; // Should not happen
            printContentViaIframe(generateA4ReceiptContent(pesanan), 'A4');
        }

        function cetakHistoryItemTermal(index) {
            const pesanan = historyList[index];
            if (!pesanan) return;
            printContentViaIframe(generateThermalReceiptContent(pesanan), 'Thermal');
        }

        function cetakHistoryItemA4(index) {
            const pesanan = historyList[index];
            if (!pesanan) return;
            printContentViaIframe(generateA4ReceiptContent(pesanan), 'A4');
        }


        function cetakDaftarPesananTermal() {
            if (pesananList.length === 0) {
                alert('Tidak ada pesanan dalam daftar untuk dicetak.');
                return;
            }
            let allThermalReceipts = '';
            pesananList.forEach(pesanan => {
                // Add content for each order, and a clear visual break for thermal
                allThermalReceipts += generateThermalReceiptContent(pesanan) + '<br>------------------------------------<br><br>';
            });
            printContentViaIframe(allThermalReceipts, 'Thermal');
        }

        function cetakDaftarPesananA4() {
            if (pesananList.length === 0) {
                alert('Tidak ada pesanan dalam daftar untuk dicetak.');
                return;
            }
            let allA4Receipts = '';
            pesananList.forEach(pesanan => {
                // Add content for each order, and force a page break for A4
                allA4Receipts += generateA4ReceiptContent(pesanan) + '<div style="page-break-after: always;"></div>';
            });
            printContentViaIframe(allA4Receipts, 'A4');
        }

        function cetakRiwayatTermal() {
            if (historyList.length === 0) {
                alert('Tidak ada riwayat pesanan untuk dicetak.');
                return;
            }
            let allThermalReceipts = '';
            historyList.forEach(pesanan => {
                allThermalReceipts += generateThermalReceiptContent(pesanan) + '<br>------------------------------------<br><br>';
            });
            printContentViaIframe(allThermalReceipts, 'Thermal');
        }

        function cetakRiwayatA4() {
            if (historyList.length === 0) {
                alert('Tidak ada riwayat pesanan untuk dicetak.');
                return;
            }
            let allA4Receipts = '';
            historyList.forEach(pesanan => {
                allA4Receipts += generateA4ReceiptContent(pesanan) + '<div style="page-break-after: always;"></div>';
            });
            printContentViaIframe(allA4Receipts, 'A4');
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateHarga(); // Initialize price display on load
            showBrandOptions(); // Initialize brand options if a category is pre-selected (e.g., from local storage)
        });
    </script>
</body>
</html>
