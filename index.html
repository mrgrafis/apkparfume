<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pemesanan Parfum</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* General Body Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f2f0, #e0e5f0);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Changed to 100vh for full page */
            margin: 0;
            padding: 30px;
            color: #333;
            box-sizing: border-box;
        }

        /* Main Application Container */
        .app-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 900px;
            margin-bottom: 30px;
            box-sizing: border-box;
        }

        /* Navigation Menu Styles */
        .nav-menu {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .nav-menu button {
            background-color: #fff;
            color: #495057;
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            font-size: 17px;
            margin: 0;
            border-radius: 8px 8px 0 0;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
            flex-grow: 1;
            min-width: 120px;
        }
        .nav-menu button.active {
            background-color: #007bff;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2);
            font-weight: bold;
        }
        .nav-menu button:hover:not(.active) {
            background-color: #f0f0f0;
            color: #333;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Content Section Styles */
        .content-section {
            display: none;
            padding-top: 20px;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Heading Styles */
        h2 {
            text-align: center;
            color: #37474f;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }
        h2::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background-color: #007bff;
            margin: 10px auto 0;
            border-radius: 2px;
        }

        /* Form Group Styles */
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            color: #546e7a;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 24px);
            padding: 12px;
            border: 1px solid #cfd8dc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
            background-color: #e3f2fd;
        }

        /* Radio Group Styles */
        .radio-group-horizontal label {
            display: inline-block;
            margin-right: 25px;
            font-weight: normal;
            color: #546e7a;
        }
        input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.1);
            cursor: pointer;
        }

        /* Button Styles */
        button {
            background-color: #007bff;
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2);
        }
        button:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 10px rgba(0, 86, 179, 0.3);
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 86, 179, 0.4);
        }

        /* Action Buttons Layout */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 25px;
        }
        .action-buttons button {
            flex: 1 1 calc(50% - 10px);
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .action-buttons.wide button {
            flex: 1 1 100%;
        }

        /* Info Display Styles */
        #hargaInfo, #totalKeseluruhanInfo {
            font-weight: bold;
            color: #1e88e5;
            margin-top: 15px;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.1em;
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #90caf9;
        }
        #brandParfumGroup {
            display: none;
        }

        /* List Item Styles */
        #daftarPesanan, #riwayatPesanan {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #daftarPesanan li, #riwayatPesanan li {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        #daftarPesanan li:hover, #riwayatPesanan li:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
        }
        #daftarPesanan li strong, #riwayatPesanan li strong {
            color: #37474f;
            font-size: 1.1em;
        }

        /* Item Action Buttons (inside list items) */
        .item-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        .item-actions button {
            width: auto;
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 0;
            border-radius: 5px;
            border: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .btn-hapus { background-color: #e53935; color: white; }
        .btn-hapus:hover { background-color: #b71c1c; box-shadow: 0 2px 5px rgba(183, 28, 28, 0.3); }
        .btn-arsip { background-color: #6c757d; color: white; }
        .btn-arsip:hover { background-color: #495057; box-shadow: 0 2px 5px rgba(73, 80, 87, 0.3); }
        .btn-cetak-item-a4 { background-color: #29b6f6; color: white; }
        .btn-cetak-item-a4:hover { background-color: #0288d1; box-shadow: 0 2px 5px rgba(2, 136, 209, 0.3); }
        .btn-cetak-item-termal { background-color: #8bc34a; color: white; }
        .btn-cetak-item-termal:hover { background-color: #689f38; box-shadow: 0 2px 5px rgba(104, 159, 56, 0.3); }
        .btn-pdf { background-color: #dc3545; color: white; }
        .btn-pdf:hover { background-color: #c82333; box-shadow: 0 2px 5px rgba(200, 35, 51, 0.3); }


        /* No Pesanan Message */
        .no-pesanan {
            text-align: center;
            color: #78909c;
            font-style: italic;
            padding: 20px;
            background-color: #f0f4f7;
            border-radius: 8px;
            margin-top: 20px;
        }

        /* ======================================================= */
        /* PRINT CSS - INI YANG PENTING UNTUK MENCETAK DENGAN BENAR */
        /* ======================================================= */

        /* Iframe for printing - initially hidden */
        #printIframe {
            display: none;
            visibility: hidden;
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 1px;
            height: 1px;
            border: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Styles applied ONLY when printing */
        @media print {
            /* Hide ALL main UI elements that should NOT be printed */
            body > *:not(#printIframe) {
                display: none !important;
            }
            .app-container,
            .nav-menu,
            .content-section,
            .action-buttons,
            #hargaInfo,
            #totalKeseluruhanInfo {
                display: none !important;
            }

            /* Show the iframe and make it take over the print area */
            #printIframe {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                top: auto !important;
                left: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                overflow: visible !important;
            }

            /* Global @page rules for the main document - useful as a fallback */
            @page {
                margin: 0 !important;
                padding: 0 !important;
                size: auto;
            }
        }

        /* --- STYLES FOR THERMAL RECEIPT CONTENT (INSIDE IFRAME) --- */
        /* These styles will be injected into the iframe's <head> when printing thermal */
        /* Use a specific class for the body of the thermal receipt iframe */
        .receipt-thermal-body {
            width: 55mm;
            max-width: 55mm;
            min-height: 10mm;
            margin: 0;
            padding: 0;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.3;
            color: #000;
            box-sizing: border-box;

            zoom: 125%;
        }
        /* Reset aggressive margins/padding for all elements inside thermal receipt */
        .receipt-thermal-body * {
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
        }

        /* Specific padding/spacing for elements inside thermal receipt */
        .receipt-thermal-body .header,
        .receipt-thermal-body .footer,
        .receipt-thermal-body .section-title,
        .receipt-thermal-body .item-list,
        .receipt-thermal-body .summary-details {
            padding: 0 2mm !important;
        }
        .receipt-thermal-body hr {
            border: none;
            border-top: 1px dashed #000;
            margin: 2mm 2mm !important;
            width: calc(100% - 4mm) !important;
        }
        .receipt-thermal-body .header h3 {
            font-size: 1.2em;
            margin-bottom: 0.5mm !important;
            text-align: center;
        }
        .receipt-thermal-body .header p {
            font-size: 0.9em;
            margin-bottom: 0.2mm !important;
            text-align: center;
        }
        .receipt-thermal-body .section-title {
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            margin: 2mm 0 !important;
        }
        .receipt-thermal-body .item {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 2mm !important;
            padding: 0 2mm !important;
        }
        .receipt-thermal-body .item .item-name {
            flex-basis: 100%;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 1mm !important;
            white-space: normal;
            word-break: break-word;
            text-align: left;
        }
        .receipt-thermal-body .item .item-qty-price {
            flex-basis: 60%;
            text-align: left;
            font-size: 1em;
        }
        .receipt-thermal-body .item .item-total-price {
            flex-basis: 40%;
            text-align: right;
            font-weight: bold;
            font-size: 1em;
        }

        .receipt-thermal-body .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 1mm !important;
            padding: 0 2mm !important;
        }
        .receipt-thermal-body .detail-row.bold {
            font-weight: bold;
        }

        .receipt-thermal-body .total-summary {
            font-size: 1.3em;
            margin-top: 5px !important;
            padding-top: 5px !important;
            font-weight: bold;
            text-align: right;
            padding-right: 2mm !important;
        }
        .receipt-thermal-body .footer p {
            font-size: 0.9em;
            margin: 1mm 0 !important;
            text-align: center;
        }
        .receipt-thermal-body .info-note {
            font-size: 0.7em;
            margin-top: 2mm !important;
            text-align: center;
        }

        /* --- STYLES FOR A4 RECEIPT CONTENT (INSIDE IFRAME) --- */
        /* These styles will be injected into the iframe's <head> when printing A4 */
        .receipt-a4-body {
            padding: 20px;
            width: 210mm;
            margin: 0 auto;
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #000;
            box-sizing: border-box;
        }
        .receipt-a4-body h3, .receipt-a4-body h4 {
            text-align: center;
            margin-bottom: 15px;
        }
        .receipt-a4-body .order-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .receipt-a4-body .order-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .receipt-a4-body .order-details p {
            margin: 2px 0;
        }
        .receipt-a4-body .total-overall {
            text-align: right;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        .receipt-a4-body .order-detail-box {
            border: 1px solid #007bff;
            padding: 15px;
            border-radius: 8px;
            background-color: #e7f0ff;
            margin-bottom: 20px;
        }
        .receipt-a4-body .order-detail-box p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .receipt-a4-body .order-detail-box strong {
            color: #0056b3;
        }
        .receipt-a4-body .order-detail-box .total {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
            text-align: right;
            border-top: 1px dashed #007bff;
            padding-top: 5px;
        }

        /* Styles for PDF content generation (hidden div) */
        .pdf-content-wrapper {
            width: 210mm;
            padding: 20mm;
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #000;
            box-sizing: border-box;
            display: none;
            position: absolute;
            left: -9999px;
            top: -9999px;
            background-color: white;
        }
        .pdf-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .pdf-header h3 {
            margin: 0;
            font-size: 1.8em;
            color: #007bff;
        }
        .pdf-header p {
            margin: 5px 0 0;
            font-size: 0.9em;
            color: #555;
        }
        .pdf-section-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-top: 25px;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }
        .pdf-order-item {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .pdf-order-item strong {
            display: block;
            margin-bottom: 8px;
            font-size: 1.2em;
            color: #0056b3;
        }
        .pdf-order-item p {
            margin: 3px 0;
            font-size: 1em;
        }
        .pdf-total-summary {
            text-align: right;
            font-size: 1.6em;
            font-weight: bold;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid #000;
            color: #007bff;
        }
        .pdf-footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.9em;
            color: #777;
            border-top: 1px dashed #ccc;
            padding-top: 15px;
        }

        /* --- NEW: Home Page Styles --- */
        .home-content {
            text-align: center;
            padding: 40px 20px;
            background-color: #f7f9fc;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .home-content h1 {
            color: #007bff;
            font-size: 2.8em;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .home-content p {
            font-size: 1.2em;
            color: #555;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        .home-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .home-buttons button {
            width: 250px;
            padding: 18px 30px;
            font-size: 1.4em;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.25);
            margin-top: 0; /* Override default button margin-top */
        }
        .home-buttons button:nth-child(1) { background-color: #28a745; }
        .home-buttons button:nth-child(1):hover { background-color: #218838; }
        .home-buttons button:nth-child(2) { background-color: #ffc107; color: #333; }
        .home-buttons button:nth-child(2):hover { background-color: #e0a800; }

        /* --- NEW: Catalog Page Styles --- */
        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            padding: 10px;
            margin-top: 20px;
        }
        .catalog-item {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .catalog-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .catalog-item::before {
            content: attr(data-category);
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            text-transform: capitalize;
            z-index: 1;
        }
        .catalog-item h3 {
            color: #007bff;
            font-size: 1.6em;
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px dashed #e0e0e0;
            padding-bottom: 10px;
        }
        .catalog-item p {
            font-size: 0.95em;
            line-height: 1.5;
            color: #444;
            margin-bottom: 8px;
        }
        .catalog-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }
        .catalog-item ul {
            list-style: none;
            padding: 0;
            margin: 5px 0 15px;
            font-size: 0.9em;
            color: #666;
        }
        .catalog-item ul li {
            background-color: #e6f7ff;
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 3px;
            display: inline-block;
            margin-right: 5px;
        }
        .catalog-item .character-tag {
            display: inline-block;
            background-color: #d4edda;
            color: #155724;
            padding: 5px 10px;
            border-radius: 15px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.85em;
        }
        .catalog-item .character-section {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        .catalog-item .character-section strong {
            color: #28a745;
        }
        .catalog-filter-bar {
            text-align: center;
            margin-bottom: 20px;
        }
        .catalog-filter-bar select {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1em;
            min-width: 200px;
            margin: 0 10px;
        }

        /* NEW CSS: Hide app-container nav and content-sections by default */
        .app-container.home-only {
            padding: 0;
            box-shadow: none;
            background-color: transparent;
            max-width: 600px;
            display: block;
            min-height: auto; /* Adjust for home content */
        }

        .app-container.home-only .nav-menu,
        .app-container.home-only #katalog,
        .app-container.home-only #pemesanan,
        .app-container.home-only #daftar,
        .app-container.home-only #riwayat {
            display: none !important;
        }

        /* Ensure home content is visible when home-only */
        .app-container.home-only #home {
            display: block !important;
            padding-top: 0 !important;
        }
    </style>
</head>
<body>
    <div class="app-container home-only">
        <div class="nav-menu print-hide">
            <button class="nav-button" data-target="home">Home</button>
            <button class="nav-button" data-target="katalog">Katalog Parfum</button>
            <button class="nav-button" data-target="pemesanan">Form Pemesanan</button>
            <button class="nav-button" data-target="daftar">Daftar Pesanan</button>
            <button class="nav-button" data-target="riwayat">Riwayat Pesanan</button>
        </div>

        <div id="home" class="content-section active">
            <div class="home-content">
                <h1>Selamat Datang di Energia Aura Parfume</h1>
                <p>Temukan aroma yang sempurna yang mencerminkan kepribadian dan gaya Anda. Jelajahi katalog parfum kami yang beragam atau langsung pesan aroma favorit Anda!</p>
                <div class="home-buttons">
                    <button onclick="goToTab('katalog')">Jelajahi Katalog</button>
                    <button onclick="goToTab('pemesanan')">Mulai Pemesanan</button>
                </div>
            </div>
        </div>

        <div id="katalog" class="content-section">
            <h2>Katalog Parfum Kami</h2>
            <div class="catalog-filter-bar">
                <label for="filterCategory">Filter Kategori:</label>
                <select id="filterCategory" onchange="renderCatalog()">
                    <option value="all">Semua Kategori</option>
                    <option value="pria">Pria</option>
                    <option value="wanita">Wanita</option>
                    <option value="unisex">Unisex</option>
                    <option value="pasangan">Pasangan</option>
                </select>
            </div>
            <div id="catalogGrid" class="catalog-grid">
                <p class="no-pesanan">Katalog sedang dimuat...</p>
            </div>
        </div>

        <div id="pemesanan" class="content-section">
            <h2>Form Pemesanan Parfum</h2>
            <form id="parfumForm">
                <div class="form-group">
                    <label for="nama">Nama Pemesan:</label>
                    <input type="text" id="nama" name="nama" required>
                </div>

                <div class="form-group" id="kategoriParfumGroup">
                    <label>Pilih Kategori Parfum:</label>
                    <div class="radio-group-horizontal">
                        <input type="radio" id="kategoriPria" name="kategori" value="pria" onchange="showBrandOptions()" required>
                        <label for="kategoriPria">Pria</label>
                        <input type="radio" id="kategoriWanita" name="kategori" value="wanita" onchange="showBrandOptions()">
                        <label for="kategoriWanita">Wanita</label>
                        <input type="radio" id="kategoriUnisex" name="kategori" value="unisex" onchange="showBrandOptions()">
                        <label for="kategoriUnisex">Unisex</label>
                        <input type="radio" id="kategoriPasangan" name="kategori" value="pasangan" onchange="showBrandOptions()">
                        <label for="kategoriPasangan">Pasangan</label>
                    </div>
                </div>

                <div class="form-group" id="brandParfumGroup">
                    <label for="brandParfum">Pilih Brand Parfum:</label>
                    <select id="brandParfum" name="brandParfum">
                        <option value="">-- Pilih Brand Parfum --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="keharumanLain">Atau tulis keharuman/brand lain (opsional):</label>
                    <input type="text" id="keharumanLain" name="keharumanLain" placeholder="Contoh: Kopi, Vanilla Musk, Brand ABC">
                </div>

                <div class="form-group">
                    <label>Jenis Parfum (Ukuran 30ml):</label>
                    <div class="radio-group-horizontal">
                        <input type="radio" id="premium" name="jenisParfum" value="Premium" data-harga="100000" required onchange="updateHarga()">
                        <label for="premium">Premium (Rp 100.000)</label>
                        <input type="radio" id="superPremium" name="jenisParfum" value="Super Premium" data-harga="125000" onchange="updateHarga()">
                        <label for="superPremium">Super Premium (Rp 125.000)</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="jumlah">Jumlah:</label>
                    <input type="number" id="jumlah" name="jumlah" min="1" value="1" required onchange="updateHarga()">
                </div>

                <div id="hargaInfo">Total Harga Item: Rp 0</div>

                <div class="action-buttons wide">
                    <button type="submit" id="btnSimpanPesanan">Simpan Pesanan</button>
                    <button type="button" id="btnCetakPesananSaatIniA4" onclick="cetakPesananSaatIniA4()" style="background-color: #29b6f6;">Cetak Pesanan Saat Ini (A4)</button>
                    <button type="button" id="btnCetakPesananSaatIniTermal" onclick="cetakPesananSaatIniTermal()" style="background-color: #8bc34a;">Cetak Struk Pesanan Saat Ini (Mini)</button>
                </div>
            </form>
        </div>

        <div id="daftar" class="content-section">
            <h2>Daftar Pesanan Tersimpan</h2>
            <ul id="daftarPesanan">
                <p class="no-pesanan">Belum ada pesanan tersimpan.</p>
            </ul>
            <div id="totalKeseluruhanInfo">Total Keseluruhan: Rp 0</div>

            <div class="action-buttons wide">
                <button type="button" id="btnCetakTermalMini" onclick="cetakDaftarPesananTermal()" style="background-color: #8bc34a;">Cetak Semua Struk (Mini)</button>
                <button type="button" id="btnCetakSaya" onclick="cetakDaftarPesananA4()" style="background-color: #17a2b8;">Cetak Detail Laporan (A4)</button>
                <button type="button" id="btnSimpanPDF" onclick="saveAllOrdersToPdf()" class="btn-pdf">Simpan Semua ke PDF</button>
            </div>
            <div class="action-buttons">
                <button type="button" id="btnResetPesanan" onclick="resetPesanan()" class="btn-hapus">Hapus Semua Pesanan</button>
                <button type="button" id="btnArsipSemua" onclick="arsipSemuaPesanan()" class="btn-arsip">Arsipkan Semua Pesanan</button>
            </div>
        </div>

        <div id="riwayat" class="content-section">
            <h2>Riwayat Pemesanan</h2>
            <ul id="riwayatPesanan">
                <p class="no-pesanan">Belum ada riwayat pesanan.</p>
            </ul>
            <div class="action-buttons wide">
                <button type="button" id="btnCetakRiwayatTermal" onclick="cetakRiwayatTermal()" style="background-color: #8bc34a;">Cetak Riwayat (Mini)</button>
                <button type="button" id="btnCetakRiwayatA4" onclick="cetakRiwayatA4()" style="background-color: #6f42c1;">Cetak Riwayat Lengkap (A4)</button>
                <button type="button" id="btnHapusRiwayat" onclick="hapusRiwayat()" class="btn-hapus">Hapus Semua Riwayat</button>
            </div>
        </div>
    </div>

    <iframe id="printIframe" name="printIframe" style="display: none; visibility: hidden; width: 1px; height: 1px;"></iframe>
    <div id="pdfContentWrapper" class="pdf-content-wrapper"></div>


    <script>
        // DOM Elements
        const parfumForm = document.getElementById('parfumForm');
        const daftarPesananUL = document.getElementById('daftarPesanan');
        const riwayatPesananUL = document.getElementById('riwayatPesanan');
        const hargaInfo = document.getElementById('hargaInfo');
        const totalKeseluruhanInfo = document.getElementById('totalKeseluruhanInfo');
        const brandParfumSelect = document.getElementById('brandParfum');
        const brandParfumGroup = document.getElementById('brandParfumGroup');
        const navButtons = document.querySelectorAll('.nav-button');
        const contentSections = document.querySelectorAll('.content-section');
        const pdfContentWrapper = document.getElementById('pdfContentWrapper');
        const catalogGrid = document.getElementById('catalogGrid');
        const filterCategorySelect = document.getElementById('filterCategory');


        let pesananList = [];
        let historyList = [];

        // Data Brand Parfum
        const brandParfumData = {
            pria: [ "Acqua di Parma", "Armani Code", "Bleu de Chanel", "Boss Bottled", "Bvlgari Man", "Carolina Herrera Bad Boy", "Chanel Allure Homme Sport", "Christian Dior Sauvage", "Creed Aventus", "Davidoff Cool Water", "Dior Homme", "Dolce & Gabbana The One For Men", "Dunhill Icon", "Giorgio Armani Acqua di Gio", "Givenchy Gentleman", "Gucci Guilty Pour Homme", "Hermès Terre d'Hermès", "Invictus Paco Rabanne", "Jean Paul Gaultier Le Male", "Jo Malone Wood Sage & Sea Salt (Men)", "John Varvatos Artisan", "Lacoste L.12.12", "Montblanc Explorer", "Nautica Voyage", "Paco Rabanne 1 Million", "Polo Ralph Lauren Blue", "Prada L'Homme", "Tom Ford Oud Wood", "Versace Dylan Blue", "Viktor & Rolf Spicebomb", "YSL Y", "Azzaro Wanted", "Bentley For Men Intense", "Burberry Brit For Men", "Calvin Klein Eternity for Men", "Coach For Men", "Dolce & Gabbana K", "DSQUARED2 Wood Pour Homme", "Ermenegildo Zegna Uomo", "Ferrari Black", "Gucci Guilty Absolute", "Issey Miyake L'Eau d'Issey Pour Homme", "Jimmy Choo Man", "Kenzo Pour Homme", "Loewe 7", "Mancera Cedrat Boise", "Maison Margiela Replica Jazz Club", "Mugler A*Men", "Narciso Rodriguez For Him", "Paco Rabanne Phantom", "Penhaligon's Halfeti", "Ralph Lauren Polo Green", "Roja Dove Elysium", "Salvatore Ferragamo F by Ferragamo", "Thierry Mugler Alien Man", "Tommy Hilfiger Tommy", "Trussardi My Land", "Valentino Uomo Born In Roma", "Van Cleef & Arpels Pour Homme", "Versace Eros", "Victorinox Swiss Army Classic", "Yves Saint Laurent Kouros", "Zegna Essenze Collection", "Adnan B. Royal Touch", "Alfred Dunhill Desire Blue", "Antonio Banderas Blue Seduction", "Bottega Veneta Pour Homme", "Brioni Eau de Parfum", "Cartier Pasha de Cartier", "Coach Platinum", "Creed Green Irish Tweed", "Diesel Only The Brave", "Ermenegildo Zegna Z Zegna", "Ferrari Scuderia Black", "Givenchy Pi", "Gucci Pour Homme II", "Guess Seductive Homme Blue", "Hugo Boss The Scent", "Jaguar Classic Black", "Joop! Homme", "Karl Lagerfeld Pour Homme", "Lalique Encre Noire", "Mercedes-Benz Man", "Michael Kors for Men", "Montblanc Legend", "Mugler Cologne", "Paco Rabanne Pure XS", "Penhaligon's Blenheim Bouquet", "Porsche Design 180", "Ralph Lauren Polo Black", "Roja Dove Scandal Pour Homme", "Sergio Tacchini O-Zone Man", "Ted Lapidus Pour Homme", "Tom Ford Beau De Jour", "Truefitt & Hill Trafalgar", "Uomo Salvatore Ferragamo", "Van Gils Between Sheets", "Versace Pour Homme", "Yves Saint Laurent Kouros", "Zadig & Voltaire This Is Him!", "Zara Man Gold", "Ajmal Evoke Gold Edition For Him" ],
            wanita: [ "Ariana Grande Cloud", "Black Opium YSL", "Britney Spears Fantasy", "Bvlgari Omnia Crystalline", "Calvin Klein Euphoria", "Carolina Herrera Good Girl", "Chanel Chance Eau Tendre", "Chanel Coco Mademoiselle", "Chloe Eau de Parfum", "Christian Dior J'adore", "Dior Miss Dior", "Dolce & Gabbana Light Blue", "Elizabeth Arden 5th Avenue", "Estee Lauder Beautiful", "Givenchy L'Interdit", "Giorgio Armani My Way", "Gucci Bloom", "Guerlain Mon Guerlain", "Jean Paul Gaultier La Belle", "Jo Malone Peony & Blush Suede", "Jimmy Choo Blossom", "Lancôme La Vie Est Belle", "Marc Jacobs Daisy", "Mugler Alien", "Narciso Rodriguez For Her", "Paco Rabanne Lady Million", "Prada Candy", "Thierry Mugler Angel", "Tom Ford Black Orchid", "Versace Bright Crystal", "Viktor & Rolf Flowerbomb", "Yves Saint Laurent Libre", "Burberry Her", "Byredo Mojave Ghost", "Carolina Herrera 212 NYC", "Chanel No. 5", "Clean Reserve Warm Cotton", "Dior Poison Girl", "Donna Karan DKNY Be Delicious", "Elizabeth Taylor White Diamonds", "Escada Miami Blossom", "Estee Lauder Pleasures", "Giorgio Armani Si", "Givenchy Irresistible", "Gucci Flora Gorgeous Gardenia", "Guerlain Shalimar", "Hugo Boss Woman", "Issey Miyake L'Eau d'Issey", "Jean Paul Gaultier Classique", "Juliette Has A Gun Not a Perfume", "Kenzo Flower", "Kilian Love, Don't Be Shy", "Lanvin Eclat d'Arpège", "Loewe Aura", "Maison Margiela Replica Beach Walk", "Michael Kors Glam Jasmine", "Moschino Toy 2", "Nina Ricci L'Air du Temps", "Paco Rabanne Fame", "Penhaligon's Luna", "Philosophy Amazing Grace", "Ralph Lauren Romance", "Roja Dove Enigma Pour Femme", "Salvatore Ferragamo Signorina", "Shiseido Ever Bloom", "Stella McCartney Stella", "The Body Shop White Musk", "Tiffany & Co. Eau de Parfum", "Tom Ford Orchid Soleil", "Tous Tous Tous Bear", "Trussardi Donna", "Valentino Donna Born In Roma", "Van Cleef & Arpels Feerie", "Vera Wang Princess", "Victoria's Secret Bombshell", "Zara Orchid", "Elizabeth Arden Green Tea", "Escada Cherry in Japan", "Clinique Happy", "DKNY Stories", "Elie Saab Le Parfum", "Gucci Rush", "Guess Seductive", "Hollister Wave For Her", "Jesus Del Pozo Halloween", "Juicy Couture Viva La Juicy", "Kate Spade New York", "Kylie Minogue Darling", "Maison Francis Kurkdjian Baccarat Rouge 540 (Women)", "Moschino I Love Love", "Narciso Rodriguez Pure Musc", "Oscar de la Renta Oscar", "Rihanna Reb'l Fleur", "Tommy Hilfiger Tommy Girl", "Versace Crystal Noir", "Victoria's Secret Tease", "YSL Mon Paris", "Zoella Beauty Splash", "Afnan Supremacy Not Only Intense" ],
            unisex: [ "Byredo Gypsy Water", "Byredo Bal d'Afrique", "Calvin Klein CK One", "Clean Reserve Rain", "D.S. & Durga Debaser", "Diptyque Philosykos", "Escentric Molecules Molecule 01", "Ex Nihilo Fleur Narcotique", "Frederic Malle Portrait of a Lady", "Glossier You", "Initio Parfums Prives Oud for Greatness", "Jo Malone Lime Basil & Mandarin", "Kilian Back to Black", "Le Labo Santal 33", "Maison Francis Kurkdjian Baccarat Rouge 540", "Maison Margiela Replica By the Fireplace", "Memo Paris Irish Leather", "Montale Intense Cafe", "Nishane Hacivat", "Ormonde Jayne Ormonde Man", "Parfums de Marly Layton", "Penhaligon's The Tragedy of Lord George", "Roja Dove Aoud", "Serge Lutens Chergui", "Tiziana Terenzi Kirke", "Tom Ford Tobacco Vanille", "Xerjoff Naxos", "Amouage Interlude Man", "Atelier Cologne Orange Sanguine", "Bond No. 9 Wall Street", "Creed Royal Oud", "DSQUARED2 Wood Sage", "Eight & Bob Original", "Floris No. 89", "Givenchy Hot Couture", "Gucci Mémoire d'une Odeur", "Heeley Sel Marin", "Imaginary Authors A City on Fire", "Jovoy Paris Psychedelique", "Kismet Angel by Maison Alhambra", "Lalique White", "Louis Vuitton Ombre Nomade", "Maison Crivelli Papyrus Moléculaire", "Memo Paris African Leather", "Montale Black Aoud", "Nasomatto Black Afgano", "Ormonde Jayne Montabaco", "Parfums de Marly Herod", "Penhaligon's Endymion", "Phaedon Antigua", "Roja Dove Reckless", "Serge Lutens Ambre Sultan", "The House of Oud Breath Of The Infinite", "Tom Ford Fucking Fabulous", "Tiziana Terenzi Laudano Nero", "Xerjoff Alexandria II", "Zara Ebony Wood", "Zarkoperfume Cloud Collection No.1", "Amouage Reflection Man", "Atelier Cologne Vanille Insensée", "Bond No. 9 New York Oud", "Creed Virgin Island Water", "Demeter Fragrance Library", "Eight & Bob Annicke Goutal", "Floris Santal", "Givenchy Insense", "Gucci The Alchemist's Garden", "Guess Seductive", "Hollister Wave For Her", "Jesus Del Pozo Halloween", "Juicy Couture Viva La Juicy", "Kate Spade New York", "Kylie Minogue Darling", "Maison Francis Kurkdjian Baccarat Rouge 540 (Unisex)", "Moschino I Love Love", "Narciso Rodriguez Pure Musc", "Oscar de la Renta Oscar", "Rihanna Reb'l Fleur", "Tommy Hilfiger Tommy Girl", "Versace Crystal Noir", "Victoria's Secret Tease", "YSL Mon Paris", "Zoella Beauty Splash", "Afnan Supremacy Not Only Intense" ],
            pasangan: [ "Calvin Klein Obsessed For Men & Women", "Jo Malone English Pear & Freesia (Unisex/Pairing)", "Tom Ford Ombre Leather (Often Paired)", "Byredo Mixed Emotions (Often Paften Paired)", "Initio Parfums Prives Oud for Greatness (Pairing)", "Montale Intense Cafe & Roses Musk (Pairing)", "Le Labo Bergamote 22 & Santal 33 (Pairing)", "Roja Dove Scandal Pour Homme & Enigma Pour Femme (Pairing)", "Creed Aventus & Aventus for Her (Pairing)", "YSL Y & Libre (Pairing)", "Dior Sauvage & J'adore (Pairing)", "Chanel Bleu de Chanel & Coco Mademoiselle (Pairing)", "Paco Rabanne 1 Million & Lady Million (Pairing)", "Giorgio Armani Acqua di Gio & My Way (Pairing)", "Versace Eros & Bright Crystal (Pairing)", "Dolce & Gabbana The One For Men & The One For Women (Pairing)", "Givenchy Gentleman & L'Interdit (Pairing)", "Gucci Guilty Pour Homme & Guilty Pour Femme (Pairing)", "Hermès Terre d'Hermès & Twilly d'Hermès (Pairing)", "Polo Ralph Lauren Blue & Romance (Pairing)", "Prada L'Homme & La Femme (Pairing)", "Viktor & Rolf Spicebomb & Flowerbomb (Pairing)", "Penhaligon's Endymion & Luna (Pairing)", "Maison Margiela Replica By the Fireplace & Jazz Club (Pairing)", "Amouage Interlude Man & Interlude Woman (Pairing)", "Xerjoff Naxos & Erba Pura (Pairing)", "Bvlgari Man & Omnia Crystalline (Pairing)", "Hugo Boss Bottled & Boss The Scent for Her (Pairing)", "Lacoste L.12.12 Pour Homme & Pour Femme (Pairing)", "Montblanc Explorer & Legend Spirit (Pairing for fresh)", "Nishane Hacivat & Ani (Pairing)", "Ormonde Jayne Ormonde Man & Woman (Pairing)", "Parfums de Marly Layton & Delina (Pairing)", "Serge Lutens Chergui & Ambre Sultan (Pairing for oriental)", "Tiziana Terenzi Kirke & Andromeda (Pairing)", "Zara Vibrant Leather & Zara Orchid (Pairing)", "Zarkoperfume Cloud Collection No.1 & No.2 (Pairing)", "Bottega Veneta Pour Homme & Femme (Pairing)", "Burberry Brit For Men & Her (Pairing)", "Calvin Klein Eternity for Men & Women (Pairing)", "Coach For Men & Women (Pairing)", "Diesel Only The Brave & Loverdose (Pairing)", "Dunhill Icon & Desire (Pairing)", "Elizabeth Arden 5th Avenue & Green Tea (Pairing)", "Estee Lauder Beautiful & Pleasures (Pairing)", "Guerlain L'Homme Ideal & Mon Guerlain (Pairing)", "Guess Seductive Homme & Seductive (Pairing)" ]
        };

        // NEW: Data Katalog Parfum - Akan diisi secara dinamis
        let parfumCatalogData = [];

        // Function to populate parfumCatalogData from brandParfumData
        function populateParfumCatalogData() {
            parfumCatalogData = [];
            for (const category in brandParfumData) {
                if (brandParfumData.hasOwnProperty(category)) {
                    brandParfumData[category].forEach(brandName => {
                        parfumCatalogData.push({
                            name: brandName,
                            category: category,
                            description: `[DESKRIPSI PARFUM ${brandName.toUpperCase()} - ${category.toUpperCase()}] Ini adalah deskripsi default. Silakan ganti dengan deskripsi rinci tentang aroma, inspirasi, dan nuansa unik parfum ini.`,
                            notes: ["[Top Note]", "[Middle Note]", "[Base Note]"],
                            characteristics: ["[Karakteristik 1]", "[Karakteristik 2]", "[Karakteristik 3]"],
                            idealFor: `[COCOK UNTUK - ${category.toUpperCase()}] Individu yang menghargai aroma ${brandName}.`
                        });
                    });
                }
            }
            console.log("Parfum Catalog Data Populated:", parfumCatalogData.length, "items");
        }


        // Global variables to store generated HTML content for "current order"
        let thermalReceiptHtml = "";
        let a4ReceiptHtml = "";

        // --- Helper Functions ---

        function formatRupiah(angka) {
            let reverse = angka.toString().split('').reverse().join('');
            let ribuan = reverse.match(/\d{1,3}/g);
            let result = ribuan.join('.').split('').reverse().join('');
            return 'Rp ' + result;
        }

        // Modified goToTab function
        function goToTab(tabId) {
            const appContainer = document.querySelector('.app-container');

            // Always remove 'home-only' class when navigating from home buttons
            appContainer.classList.remove('home-only');

            // Deactivate all nav buttons and content sections
            navButtons.forEach(btn => btn.classList.remove('active'));
            contentSections.forEach(section => section.classList.remove('active'));

            // Activate the target tab and its corresponding content section
            const targetButton = document.querySelector(`.nav-button[data-target="${tabId}"]`);
            const targetSection = document.getElementById(tabId);

            if (targetButton) {
                targetButton.classList.add('active');
            }
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Re-render appropriate list or catalog when tab is clicked
            if (tabId === 'daftar') {
                renderPesanan();
            } else if (tabId === 'riwayat') {
                renderHistory();
            } else if (tabId === 'katalog') {
                renderCatalog();
            }
        }


        // Generate content for Thermal Receipt (more structured HTML for better styling)
        function generateThermalReceiptContent(pesanan) {
            const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
            const formattedHargaPerBotol = formatRupiah(pesanan.hargaPerBotol);
            const formattedHargaItem = formatRupiah(pesanan.hargaItem); // Use hargaItem for single item total

            // Get current date and time for receipt
            const now = new Date();
            const dateStr = `${now.getDate()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getFullYear().toString().slice(-2)}`;
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

            return `
                <div class="receipt-thermal-content">
                    <div class="header">
                        <h3>By. ENERGIA AURA PARFUME</h3>
                        <p>Jl. Komp. CikawaO Persada Blok G1 No 21</p>
                        <p>Telp: 0851-4215-6602</p>
                        <p>Tgl: ${dateStr}, ${timeStr}</p>
                    </div>
                    <hr>
                    <div class="section-title">STRUK PEMESANAN</div>
                    <div class="detail-row">
                        <span>UNTUK:</span>
                        <span class="bold">${pesanan.namaPemesanan.toUpperCase()}</span>
                    </div>
                    <hr>
                    <div class="item-list">
                        <div class="item">
                            <span class="item-name">${selectedBrand}</span>
                            <span class="item-qty-price">${pesanan.jumlah}x @${formattedHargaPerBotol}</span>
                            <span class="item-total-price">${formattedHargaItem}</span>
                        </div>
                    </div>
                    <hr>
                    <div class="detail-row total-summary">
                        <span>TOTAL:</span>
                        <span>${formattedHargaItem}</span>
                    </div>
                    <hr>
                    <div class="footer">
                        <p>TERIMA KASIH ATAS KUNJUNGANNYA</p>
                        <p class="info-note">*** BARANG YANG SUDAH DIBELI TIDAK</p>
                        <p class="info-note">    DAPAT DIKEMBALIKAN ***</p>
                        <p class="info-note">Sistem Pemesanan v1.0</p>
                    </div>
                </div>
            `;
        }


        // Generate content for A4 Receipt (more structured HTML)
        function generateA4ReceiptContent(pesanan) {
            const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
            const formattedHargaItem = formatRupiah(pesanan.hargaItem);
            const formattedHargaPerBotol = formatRupiah(pesanan.hargaPerBotol);

            const now = new Date();
            const dateStr = `${now.getDate()} Juli ${now.getFullYear()} pukul ${now.getHours().toString().padStart(2, '0')}.${now.getMinutes().toString().padStart(2, '0')}`;

            return `
                <div class="receipt-a4-content">
                    <div class="header">
                        <h3>By. ENERGIA AURA PARFUME</h3>
                        <p>Jl. Komp. CikawaO Persada Blok G1 No 21</p>
                        <p>Telp: 0851-4215-6602</p>
                        <p>Tgl: ${new Date().toLocaleDateString('id-ID', {day: '2-digit', month: '2-digit', year: '2-digit'})}, ${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</p>
                        <hr/>
                        <h4>STRUK PEMESANAN UNTUK: ${pesanan.namaPemesanan.toUpperCase()}</h4>
                    </div>
                    <div class="order-detail-box">
                        <p><strong>Nama Pemesan:</strong> ${pesanan.namaPemesanan}</p>
                        <p><strong>Kategori:</strong> ${pesanan.kategori}</p>
                        <p><strong>Parfum:</strong> ${selectedBrand}</p>
                        <p><strong>Jenis:</strong> ${pesanan.jenis}</p>
                        <p><strong>Jumlah:</strong> ${pesanan.jumlah}</p>
                        <p><strong>Harga Per Botol:</strong> ${formattedHargaPerBotol}</p>
                        <hr style="border-top: 1px dashed #007bff;"/>
                        <p class="total"><strong>Total Harga:</strong> ${formattedHargaItem}</p>
                    </div>
                    <div class="footer" style="text-align: center; margin-top: 20px;">
                        <p>TERIMA KASIH ATAS KUNJUNGANNYA</p>
                        <p>*** BARANG YANG SUDAH DIBELI TIDAK DAPAT DIKEMBALIKAN ***</p>
                        <p>Sistem Pemesanan v1.0</p>
                        <p style="font-size: 0.8em; color: #666; margin-top: 15px;">Detail pesanan ini berdasarkan input formulir saat Anda mencetak.</p>
                    </div>
                </div>
            `;
        }


        // --- Core Application Logic ---

        function showBrandOptions() {
            const kategori = document.querySelector('input[name="kategori"]:checked')?.value;
            brandParfumSelect.innerHTML = '<option value="">-- Pilih Brand Parfum --</option>'; // Reset options

            if (kategori && brandParfumData[kategori]) {
                brandParfumData[kategori].forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandParfumSelect.appendChild(option);
                });
                brandParfumGroup.style.display = 'block';
            } else {
                brandParfumGroup.style.display = 'none';
            }
            updateHarga(); // Update price whenever brand options might change
        }

        function updateHarga() {
            const jenisParfum = document.querySelector('input[name="jenisParfum"]:checked');
            const jumlah = parseInt(document.getElementById('jumlah').value);
            let harga = 0;

            if (jenisParfum) {
                harga = parseFloat(jenisParfum.dataset.harga) * jumlah;
            }

            hargaInfo.textContent = `Total Harga Item: ${formatRupiah(harga)}`;
        }

        parfumForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const namaPemesanan = document.getElementById('nama').value;
            const kategori = document.querySelector('input[name="kategori"]:checked')?.value;
            const brand = brandParfumSelect.value;
            const keharumanLain = document.getElementById('keharumanLain').value;
            const jenis = document.querySelector('input[name="jenisParfum"]:checked');
            const jumlah = parseInt(document.getElementById('jumlah').value);

            if (!namaPemesanan || !kategori || (!brand && !keharumanLain) || !jenis || !jumlah) {
                alert('Mohon lengkapi semua data pemesanan!');
                return;
            }

            const hargaPerBotol = parseFloat(jenis.dataset.harga);
            const hargaItem = hargaPerBotol * jumlah;

            const now = new Date();
            const tanggal = now.toLocaleDateString('id-ID');
            const waktu = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            const newPesanan = {
                id: Date.now(),
                namaPemesanan,
                kategori,
                brand,
                keharumanLain,
                jenis: jenis.value,
                hargaPerBotol,
                jumlah,
                hargaItem, // Total for this specific item
                tanggal,
                waktu,
                totalHarga: hargaItem // For single item, total is hargaItem
            };

            pesananList.push(newPesanan);
            savePesanan();
            renderPesanan();

            // Store the generated HTML for the *last added* order
            thermalReceiptHtml = generateThermalReceiptContent(newPesanan);
            a4ReceiptHtml = generateA4ReceiptContent(newPesanan);

            parfumForm.reset();
            brandParfumGroup.style.display = 'none'; // Hide brand select after reset
            updateHarga(); // Reset harga info

            alert('Pesanan berhasil ditambahkan!');
        });

        function renderPesanan() {
            daftarPesananUL.innerHTML = '';
            let totalKeseluruhan = 0;

            if (pesananList.length === 0) {
                daftarPesananUL.innerHTML = '<p class="no-pesanan">Belum ada pesanan tersimpan.</p>';
            } else {
                pesananList.forEach((pesanan, index) => {
                    const listItem = document.createElement('li');
                    const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';

                    listItem.innerHTML = `
                        <strong>${pesanan.namaPemesanan}</strong> - ${selectedBrand} (${pesanan.jenis})<br>
                        Jumlah: ${pesanan.jumlah} x ${formatRupiah(pesanan.hargaPerBotol)} = ${formatRupiah(pesanan.hargaItem)}
                        <br>
                        <small>${pesanan.tanggal}, ${pesanan.waktu}</small>
                        <div class="item-actions">
                            <button class="btn-cetak-item-a4" onclick="cetakItemA4(${index})">Cetak Item (A4)</button>
                            <button class="btn-cetak-item-termal" onclick="cetakItemTermal(${index})">Cetak Item (Mini)</button>
                            <button class="btn-arsip" onclick="arsipPesanan(${index})">Arsipkan</button>
                            <button class="btn-hapus" onclick="hapusPesanan(${index})">Hapus</button>
                        </div>
                    `;
                    daftarPesananUL.appendChild(listItem);
                    totalKeseluruhan += pesanan.hargaItem;
                });
            }
            totalKeseluruhanInfo.textContent = `Total Keseluruhan: ${formatRupiah(totalKeseluruhan)}`;
        }

        function renderHistory() {
            riwayatPesananUL.innerHTML = '';
            if (historyList.length === 0) {
                riwayatPesananUL.innerHTML = '<p class="no-pesanan">Belum ada riwayat pesanan.</p>';
            } else {
                historyList.forEach((pesanan, index) => {
                    const listItem = document.createElement('li');
                    const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
                    listItem.innerHTML = `
                        <strong>${pesanan.namaPemesanan}</strong> - ${selectedBrand} (${pesanan.jenis})<br>
                        Jumlah: ${pesanan.jumlah} x ${formatRupiah(pesanan.hargaPerBotol)} = ${formatRupiah(pesanan.hargaItem)}
                        <br>
                        <small>Diarsipkan: ${pesanan.tanggal}, ${pesanan.waktu}</small>
                    `;
                    riwayatPesananUL.appendChild(listItem);
                });
            }
        }

        function hapusPesanan(index) {
            if (confirm('Apakah Anda yakin ingin menghapus pesanan ini?')) {
                pesananList.splice(index, 1);
                savePesanan();
                renderPesanan();
            }
        }

        function arsipPesanan(index) {
            if (confirm('Apakah Anda yakin ingin mengarsipkan pesanan ini?')) {
                const [pesananToArchive] = pesananList.splice(index, 1);
                historyList.push(pesananToArchive);
                savePesanan();
                saveHistory();
                renderPesanan();
                renderHistory();
                alert('Pesanan berhasil diarsipkan.');
            }
        }

        function arsipSemuaPesanan() {
            if (confirm('Apakah Anda yakin ingin mengarsipkan SEMUA pesanan yang tersimpan?')) {
                historyList = historyList.concat(pesananList);
                pesananList = [];
                savePesanan();
                saveHistory();
                renderPesanan();
                renderHistory();
                alert('Semua pesanan berhasil diarsipkan.');
            }
        }

        function resetPesanan() {
            if (confirm('Apakah Anda yakin ingin menghapus SEMUA pesanan yang sedang tersimpan? Tindakan ini tidak dapat dibatalkan.')) {
                pesananList = [];
                savePesanan();
                renderPesanan();
                alert('Semua pesanan berhasil dihapus.');
            }
        }

        function hapusRiwayat() {
            if (confirm('Apakah Anda yakin ingin menghapus SEMUA riwayat pesanan? Tindakan ini tidak dapat dibatalkan.')) {
                historyList = [];
                saveHistory();
                renderHistory();
                alert('Semua riwayat pesanan berhasil dihapus.');
            }
        }

        function savePesanan() {
            localStorage.setItem('pesananList', JSON.stringify(pesananList));
        }

        function loadPesanan() {
            const savedPesanan = localStorage.getItem('pesananList');
            if (savedPesanan) {
                pesananList = JSON.parse(savedPesanan);
            }
        }

        function saveHistory() {
            localStorage.setItem('historyList', JSON.stringify(historyList));
        }

        function loadHistory() {
            const savedHistory = localStorage.getItem('historyList');
            if (savedHistory) {
                historyList = JSON.parse(savedHistory);
            }
        }

        // --- Print Functions ---

        function printHtmlContent(htmlContent, printBodyClass, cssStyles) {
            const printIframe = document.getElementById('printIframe');
            printIframe.contentDocument.open();
            printIframe.contentDocument.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Print Document</title>
                    <style>
                        body { margin: 0; padding: 0; }
                        ${cssStyles}
                        /* Specific styles for the print content */
                        .${printBodyClass} {
                           /* Styles defined in the main CSS */
                        }
                    </style>
                </head>
                <body class="${printBodyClass}">
                    ${htmlContent}
                </body>
                </html>
            `);
            printIframe.contentDocument.close();

            printIframe.onload = () => {
                try {
                    printIframe.contentWindow.focus();
                    printIframe.contentWindow.print();
                } catch (e) {
                    console.error("Error printing:", e);
                    alert("Gagal mencetak. Pastikan pop-up diizinkan atau coba lagi.");
                }
            };
        }


        // Cetak struk pesanan saat ini (dari form pemesanan)
        function cetakPesananSaatIniTermal() {
            if (thermalReceiptHtml) {
                const thermalCss = document.querySelector('style').textContent; // Get all CSS
                printHtmlContent(thermalReceiptHtml, 'receipt-thermal-body', thermalCss);
            } else {
                alert('Tidak ada pesanan terbaru untuk dicetak. Harap simpan pesanan terlebih dahulu.');
            }
        }

        function cetakPesananSaatIniA4() {
            if (a4ReceiptHtml) {
                const a4Css = document.querySelector('style').textContent; // Get all CSS
                printHtmlContent(a4ReceiptHtml, 'receipt-a4-body', a4Css);
            } else {
                alert('Tidak ada pesanan terbaru untuk dicetak. Harap simpan pesanan terlebih dahulu.');
            }
        }

        // Cetak item individu dari daftar pesanan
        function cetakItemTermal(index) {
            const pesanan = pesananList[index];
            if (pesanan) {
                const itemThermalHtml = generateThermalReceiptContent(pesanan);
                const thermalCss = document.querySelector('style').textContent;
                printHtmlContent(itemThermalHtml, 'receipt-thermal-body', thermalCss);
            } else {
                alert('Item pesanan tidak ditemukan.');
            }
        }

        function cetakItemA4(index) {
            const pesanan = pesananList[index];
            if (pesanan) {
                const itemA4Html = generateA4ReceiptContent(pesanan);
                const a4Css = document.querySelector('style').textContent;
                printHtmlContent(itemA4Html, 'receipt-a4-body', a4Css);
            } else {
                alert('Item pesanan tidak ditemukan.');
            }
        }

        // Cetak daftar pesanan keseluruhan (termal dan A4)
        function cetakDaftarPesananTermal() {
            if (pesananList.length === 0) {
                alert('Tidak ada pesanan di daftar untuk dicetak.');
                return;
            }

            let allThermalContent = '';
            pesananList.forEach(pesanan => {
                allThermalContent += generateThermalReceiptContent(pesanan) + '<div style="page-break-after: always;"></div>'; // Add page break for each receipt
            });
            const thermalCss = document.querySelector('style').textContent;
            printHtmlContent(allThermalContent, 'receipt-thermal-body', thermalCss);
        }

        function cetakDaftarPesananA4() {
            if (pesananList.length === 0) {
                alert('Tidak ada pesanan di daftar untuk dicetak.');
                return;
            }

            let totalKeseluruhan = pesananList.reduce((sum, pesanan) => sum + pesanan.hargaItem, 0);
            const now = new Date();
            const dateStr = now.toLocaleDateString('id-ID');
            const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            let itemsHtml = '';
            pesananList.forEach((pesanan, index) => {
                const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
                itemsHtml += `
                    <div class="order-item">
                        <strong>${index + 1}. ${pesanan.namaPemesanan} - ${selectedBrand}</strong><br>
                        <p>Kategori: ${pesanan.kategori}, Jenis: ${pesanan.jenis}</p>
                        <p>Jumlah: ${pesanan.jumlah} x ${formatRupiah(pesanan.hargaPerBotol)} = ${formatRupiah(pesanan.hargaItem)}</p>
                        <small>${pesanan.tanggal}, ${pesanan.waktu}</small>
                    </div>
                `;
            });

            const fullA4Content = `
                <div class="receipt-a4-body">
                    <div class="header">
                        <h3>LAPORAN PEMESANAN ENERGIA AURA PARFUME</h3>
                        <p>Jl. Komp. CikawaO Persada Blok G1 No 21</p>
                        <p>Telp: 0851-4215-6602</p>
                        <p>Tanggal Laporan: ${dateStr}, ${timeStr}</p>
                        <hr/>
                    </div>
                    <div class="section-title">Detail Pesanan Aktif</div>
                    ${itemsHtml}
                    <div class="total-overall">
                        TOTAL KESELURUHAN: ${formatRupiah(totalKeseluruhan)}
                    </div>
                    <div class="footer" style="text-align: center; margin-top: 40px;">
                        <p>Laporan ini mencakup semua pesanan yang belum diarsipkan.</p>
                        <p>Sistem Pemesanan v1.0</p>
                    </div>
                </div>
            `;
            const a4Css = document.querySelector('style').textContent;
            printHtmlContent(fullA4Content, 'receipt-a4-body', a4Css);
        }

        // Cetak riwayat pesanan (termal dan A4)
        function cetakRiwayatTermal() {
            if (historyList.length === 0) {
                alert('Tidak ada riwayat untuk dicetak.');
                return;
            }

            let allThermalContent = '';
            historyList.forEach(pesanan => {
                // Reuse the same thermal content generation, but customize header if needed
                allThermalContent += generateThermalReceiptContent(pesanan) + '<div style="page-break-after: always;"></div>';
            });
            const thermalCss = document.querySelector('style').textContent;
            printHtmlContent(allThermalContent, 'receipt-thermal-body', thermalCss);
        }

        function cetakRiwayatA4() {
            if (historyList.length === 0) {
                alert('Tidak ada riwayat untuk dicetak.');
                return;
            }

            let totalRiwayat = historyList.reduce((sum, pesanan) => sum + pesanan.hargaItem, 0);
            const now = new Date();
            const dateStr = now.toLocaleDateString('id-ID');
            const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            let itemsHtml = '';
            historyList.forEach((pesanan, index) => {
                const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
                itemsHtml += `
                    <div class="order-item">
                        <strong>${index + 1}. ${pesanan.namaPemesanan} - ${selectedBrand}</strong><br>
                        <p>Kategori: ${pesanan.kategori}, Jenis: ${pesanan.jenis}</p>
                        <p>Jumlah: ${pesanan.jumlah} x ${formatRupiah(pesanan.hargaPerBotol)} = ${formatRupiah(pesanan.hargaItem)}</p>
                        <small>Diarsipkan: ${pesanan.tanggal}, ${pesanan.waktu}</small>
                    </div>
                `;
            });

            const fullA4Content = `
                <div class="receipt-a4-body">
                    <div class="header">
                        <h3>LAPORAN RIWAYAT PEMESANAN ENERGIA AURA PARFUME</h3>
                        <p>Jl. Komp. CikawaO Persada Blok G1 No 21</p>
                        <p>Telp: 0851-4215-6602</p>
                        <p>Tanggal Laporan: ${dateStr}, ${timeStr}</p>
                        <hr/>
                    </div>
                    <div class="section-title">Detail Riwayat Pesanan</div>
                    ${itemsHtml}
                    <div class="total-overall">
                        TOTAL RIWAYAT: ${formatRupiah(totalRiwayat)}
                    </div>
                    <div class="footer" style="text-align: center; margin-top: 40px;">
                        <p>Laporan ini mencakup semua pesanan yang sudah diarsipkan.</p>
                        <p>Sistem Pemesanan v1.0</p>
                    </div>
                </div>
            `;
            const a4Css = document.querySelector('style').textContent;
            printHtmlContent(fullA4Content, 'receipt-a4-body', a4Css);
        }


        // --- PDF Generation ---

        async function saveAllOrdersToPdf() {
            if (pesananList.length === 0) {
                alert('Tidak ada pesanan di daftar untuk disimpan ke PDF.');
                return;
            }

            let totalKeseluruhan = pesananList.reduce((sum, pesanan) => sum + pesanan.hargaItem, 0);
            const now = new Date();
            const dateStr = now.toLocaleDateString('id-ID', {day: '2-digit', month: 'long', year: 'numeric'});
            const timeStr = now.toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'});

            let itemsHtml = '';
            pesananList.forEach((pesanan, index) => {
                const selectedBrand = pesanan.brand || pesanan.keharumanLain || 'Tidak ada brand/keharuman lain';
                itemsHtml += `
                    <div class="pdf-order-item">
                        <strong>${index + 1}. ${pesanan.namaPemesanan} - ${selectedBrand}</strong>
                        <p>Kategori: ${pesanan.kategori}, Jenis: ${pesanan.jenis}</p>
                        <p>Jumlah: ${pesanan.jumlah} x ${formatRupiah(pesanan.hargaPerBotol)}</p>
                        <p>Total Item: ${formatRupiah(pesanan.hargaItem)}</p>
                        <small>${pesanan.tanggal}, ${pesanan.waktu}</small>
                    </div>
                `;
            });

            pdfContentWrapper.innerHTML = `
                <div class="pdf-header">
                    <h3>LAPORAN PEMESANAN ENERGIA AURA PARFUME</h3>
                    <p>Jl. Komp. CikawaO Persada Blok G1 No 21</p>
                    <p>Telp: 0851-4215-6602</p>
                    <p>Tanggal Laporan: ${dateStr}, ${timeStr}</p>
                </div>
                <div class="pdf-section-title">Detail Pesanan Aktif</div>
                ${itemsHtml}
                <div class="pdf-total-summary">
                    TOTAL KESELURUHAN: ${formatRupiah(totalKeseluruhan)}
                </div>
                <div class="pdf-footer">
                    <p>Laporan ini mencakup semua pesanan yang belum diarsipkan.</p>
                    <p>Sistem Pemesanan v1.0</p>
                </div>
            `;

            pdfContentWrapper.style.display = 'block'; // Make visible for html2canvas

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4'); // 'p' for portrait, 'mm' for millimeters, 'a4' for A4 size

            try {
                const canvas = await html2canvas(pdfContentWrapper, { scale: 2 }); // Scale for better resolution
                const imgData = canvas.toDataURL('image/png');

                const imgWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;

                let position = 0;

                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                doc.save(`Laporan_Pesanan_${now.getFullYear()}${(now.getMonth() + 1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.pdf`);
            } catch (error) {
                console.error("Error generating PDF:", error);
                alert("Gagal membuat PDF. Coba lagi.");
            } finally {
                pdfContentWrapper.style.display = 'none'; // Hide again
                pdfContentWrapper.innerHTML = ''; // Clear content
            }
        }


        // --- Catalog Functions ---

        function renderCatalog() {
            const selectedCategory = filterCategorySelect.value;
            catalogGrid.innerHTML = ''; // Clear existing items

            const filteredCatalog = parfumCatalogData.filter(item =>
                selectedCategory === 'all' || item.category === selectedCategory
            );

            if (filteredCatalog.length === 0) {
                catalogGrid.innerHTML = '<p class="no-pesanan">Tidak ada item dalam kategori ini.</p>';
                return;
            }

            filteredCatalog.forEach(item => {
                const catalogItemDiv = document.createElement('div');
                catalogItemDiv.classList.add('catalog-item');
                catalogItemDiv.setAttribute('data-category', item.category);

                let notesHtml = '';
                if (item.notes && item.notes.length > 0) {
                    notesHtml = '<ul>' + item.notes.map(note => `<li>${note}</li>`).join('') + '</ul>';
                }

                let characteristicsHtml = '';
                if (item.characteristics && item.characteristics.length > 0) {
                    characteristicsHtml = '<div class="character-section"><strong>Karakteristik:</strong>';
                    characteristicsHtml += item.characteristics.map(char => `<span class="character-tag">${char}</span>`).join('');
                    characteristicsHtml += '</div>';
                }

                catalogItemDiv.innerHTML = `
                    <h3>${item.name}</h3>
                    <p><strong>Kategori:</strong> ${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</p>
                    <p><strong>Deskripsi:</strong> ${item.description}</p>
                    ${notesHtml ? `<p><strong>Catatan Aroma:</strong>${notesHtml}</p>` : ''}
                    ${characteristicsHtml}
                    <p><strong>Ideal Untuk:</strong> ${item.idealFor}</p>
                `;
                catalogGrid.appendChild(catalogItemDiv);
            });
        }


        // --- Initialization ---

        document.addEventListener('DOMContentLoaded', () => {
            loadPesanan();
            loadHistory();
            populateParfumCatalogData(); // Populate catalog data on load
            // Only render home content initially by ensuring app-container has 'home-only' and #home is 'active'
            document.querySelector('.app-container').classList.add('home-only');
            document.getElementById('home').classList.add('active');
        });

        // Add event listeners for navigation buttons (if they ever become visible)
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                goToTab(targetId);
            });
        });
    </script>
</body>
</html>
